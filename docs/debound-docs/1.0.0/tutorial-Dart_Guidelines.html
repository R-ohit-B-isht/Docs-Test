<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Tutorial: Dart_Guidelines</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-tutorials"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-API_Guidelines.html">API_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-API_Security_Guidelines.html">API_Security_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-Dart_Guidelines.html">Dart_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-JS_Guidelines.html">JS_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-MongoDB_Guidelines.html">MongoDB_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-Project_Guidelines.html">Project_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-Semantic_Versioning_Guidelines.html">Semantic_Versioning_Guidelines</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"><div class="navbar-item"><a id="github" href="https://github.com/SecretStencil" target="">Github</a></div><div class="navbar-item"><a id="notion" href="https://www.notion.so" target="">Notion</a></div></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section><header><h2>Dart_Guidelines</h2></header><article><h2 id="summary">Summary</h2><p>Optimize for readability. Write detailed documentation. Make error messages useful. Never use timeouts or timers. Avoid <code>is</code>, <code>print</code>, <code>part of</code>, <code>extension</code> and <code>_</code>.</p><h2 id="introduction">Introduction</h2><p>This document contains some high-level philosophy and policy decisions for the Flutter project, and a description of specific style issues for some parts of the codebase.</p><p>The style portion describes the preferred style for code written as part of the Flutter project (the framework itself and all our sample code). Flutter application developers are welcome to follow this style as well, but this is by no means required. Flutter will work regardless of what style is used to author applications that use it.</p><p>The engine repository uses <a href="https://github.com/flutter/engine/blob/master/CONTRIBUTING.md#style">other style guides for non-Dart code</a>. The language-neutral sections in this document still apply to engine code, however.</p><h2 id="table-of-contents">Table of Contents</h2><ul><li><a href="#dart_guidelines">Dart_Guidelines</a></li><li><a href="#summary">Summary</a></li><li><a href="#introduction">Introduction</a></li><li><a href="#table-of-contents">Table of Contents</a></li><li><a href="#overview">Overview</a><ul><li><a href="#a-word-on-designing-apis">A word on designing APIs</a></li></ul></li><li><a href="#philosophy">Philosophy</a><ul><li><a href="#lazy-programming">Lazy programming</a></li><li><a href="#write-test-find-bug">Write Test, Find Bug</a></li><li><a href="#avoid-duplicating-state">Avoid duplicating state</a></li><li><a href="#getters-feel-faster-than-methods">Getters feel faster than methods</a></li><li><a href="#no-synchronous-slow-work">No synchronous slow work</a></li><li><a href="#layers">Layers</a></li><li><a href="#avoid-interleaving-multiple-concepts-together">Avoid interleaving multiple concepts together</a></li><li><a href="#avoid-secret-or-global-state">Avoid secret (or global) state</a></li><li><a href="#prefer-general-apis-but-use-dedicated-apis-where-there-is-a-reason">Prefer general APIs, but use dedicated APIs where there is a reason</a></li><li><a href="#avoid-the-lowest-common-denominator">Avoid the lowest common denominator</a></li><li><a href="#avoid-apis-that-encourage-bad-practices">Avoid APIs that encourage bad practices</a></li><li><a href="#avoid-exposing-api-cliffs">Avoid exposing API cliffs</a></li><li><a href="#avoid-exposing-api-oceans">Avoid exposing API oceans</a></li><li><a href="#avoid-heuristics-and-magic">Avoid heuristics and magic</a></li><li><a href="#solve-real-problems-by-literally-solving-a-real-problem">Solve real problems by literally solving a real problem</a></li><li><a href="#get-early-feedback-when-designing-new-apis">Get early feedback when designing new APIs</a></li><li><a href="#start-designing-apis-from-the-closest-point-to-the-developer">Start designing APIs from the closest point to the developer</a></li><li><a href="#only-log-actionable-messages-to-the-console">Only log actionable messages to the console</a></li><li><a href="#error-messages-should-be-useful">Error messages should be useful</a></li><li><a href="#template-values-should-set-developers-up-for-success">Template values should set developers up for success</a></li></ul></li><li><a href="#policies">Policies</a><ul><li><a href="#plugin-compatibility">Plugin compatibility</a></li><li><a href="#workarounds">Workarounds</a></li><li><a href="#avoid-abandonware">Avoid abandonware</a></li><li><a href="#widget-libraries-follow-the-latest-oem-behavior">Widget libraries follow the latest OEM behavior</a></li><li><a href="#code-that-is-not-copyrighted-the-flutter-authors">Code that is not copyrighted &quot;The Flutter Authors&quot;</a></li></ul></li><li><a href="#documentation-dartdocs-javadocs-etc">Documentation (dartdocs, javadocs, etc)</a><ul><li><a href="#answer-your-own-questions-straight-away">Answer your own questions straight away</a></li><li><a href="#avoid-useless-documentation">Avoid useless documentation</a></li><li><a href="#writing-prompts-for-good-documentation">Writing prompts for good documentation</a></li><li><a href="#introduce-terms-as-if-every-piece-of-documentation-is-the-first-the-reader-has-ever-seen">Introduce terms as if every piece of documentation is the first the reader has ever seen</a></li><li><a href="#avoid-empty-prose">Avoid empty prose</a></li><li><a href="#leave-breadcrumbs-in-the-comments">Leave breadcrumbs in the comments</a></li><li><a href="#refactor-the-code-when-the-documentation-would-be-incomprehensible">Refactor the code when the documentation would be incomprehensible</a></li><li><a href="#canonical-terminology">Canonical terminology</a></li><li><a href="#use-correct-grammar">Use correct grammar</a></li><li><a href="#use-the-passive-voice-recommend-do-not-require-never-say-things-are-simple">Use the passive voice; recommend, do not require; never say things are simple</a></li><li><a href="#provide-sample-code">Provide sample code</a></li><li><a href="#provide-illustrations-diagrams-or-screenshots">Provide illustrations, diagrams or screenshots</a></li><li><a href="#link-to-widget-of-the-week-videos">Link to Widget of the Week videos</a></li><li><a href="#clearly-mark-deprecated-apis">Clearly mark deprecated APIs</a></li><li><a href="#use--for-public-quality-private-documentation">Use /// for public-quality private documentation</a></li><li><a href="#dartdoc-templates-and-macros">Dartdoc templates and macros</a></li><li><a href="#dartdoc-specific-requirements">Dartdoc-specific requirements</a></li></ul></li><li><a href="#coding-patterns-and-catching-bugs-early">Coding patterns and catching bugs early</a><ul><li><a href="#use-asserts-liberally-to-detect-contract-violations-and-verify-invariants">Use asserts liberally to detect contract violations and verify invariants</a></li><li><a href="#prefer-specialized-functions-methods-and-constructors">Prefer specialized functions, methods and constructors</a></li><li><a href="#minimize-the-visibility-scope-of-constants">Minimize the visibility scope of constants</a></li><li><a href="#avoid-using-if-chains-or--or--with-enum-values">Avoid using if chains or ?: or == with enum values</a></li><li><a href="#avoid-using-var-and-dynamic">Avoid using var and dynamic</a></li><li><a href="#avoid-using-library-and-part-of">Avoid using library and part of.</a></li><li><a href="#avoid-using-extension">Avoid using extension.</a></li><li><a href="#avoid-using-futureort">Avoid using FutureOr<t></t></a></li><li><a href="#avoid-using-expando">Avoid using Expando</a></li><li><a href="#avoid-using-visiblefortesting">Avoid using @visibleForTesting</a></li><li><a href="#never-check-if-a-port-is-available-before-using-it-never-add-timeouts-and-other-race-conditions">Never check if a port is available before using it, never add timeouts, and other race conditions.</a></li><li><a href="#avoid-mysterious-and-magical-numbers-that-lack-a-clear-derivation">Avoid mysterious and magical numbers that lack a clear derivation</a></li><li><a href="#have-good-hygiene-when-using-temporary-directories">Have good hygiene when using temporary directories</a></li><li><a href="#perform-dirty-checks-in-setters">Perform dirty checks in setters</a></li><li><a href="#common-boilerplates-for-operator--and-hashcode">Common boilerplates for operator == and hashCode</a></li><li><a href="#override-tostring">Override toString</a></li><li><a href="#be-explicit-about-dispose-and-the-object-lifecycle">Be explicit about dispose() and the object lifecycle</a></li><li><a href="#test-apis-belong-in-the-test-frameworks">Test APIs belong in the test frameworks</a></li><li><a href="#immutable-classes-should-not-have-hidden-state">Immutable classes should not have hidden state</a></li><li><a href="#avoid-syncasync">Avoid sync*/async*</a></li></ul></li><li><a href="#writing-tests">Writing tests</a><ul><li><a href="#make-each-test-entirely-self-contained">Make each test entirely self-contained</a></li><li><a href="#prefer-more-test-files-avoid-long-test-files">Prefer more test files, avoid long test files</a></li><li><a href="#avoid-using-pumpandsettle">Avoid using pumpAndSettle</a></li></ul></li><li><a href="#naming">Naming</a><ul><li><a href="#begin-global-constant-names-with-prefix-k">Begin global constant names with prefix &quot;k&quot;</a></li><li><a href="#avoid-abbreviations">Avoid abbreviations</a></li><li><a href="#avoid-anonymous-parameter-names">Avoid anonymous parameter names</a></li><li><a href="#naming-rules-for-typedefs-and-function-variables">Naming rules for typedefs and function variables</a></li><li><a href="#spell-words-in-identifiers-and-comments-correctly">Spell words in identifiers and comments correctly</a></li><li><a href="#capitalize-identifiers-consistent-with-their-spelling">Capitalize identifiers consistent with their spelling</a></li><li><a href="#avoid-double-negatives-in-apis">Avoid double negatives in APIs</a></li><li><a href="#prefer-naming-the-argument-to-a-setter-value">Prefer naming the argument to a setter value</a></li><li><a href="#qualify-variables-and-methods-used-only-for-debugging">Qualify variables and methods used only for debugging</a></li><li><a href="#avoid-naming-undocumented-libraries">Avoid naming undocumented libraries</a></li><li><a href="#avoid-newold-modifiers-in-code">Avoid &quot;new/old&quot; modifiers in code</a></li></ul></li><li><a href="#comments">Comments</a><ul><li><a href="#avoid-checking-in-comments-that-ask-questions">Avoid checking in comments that ask questions</a></li><li><a href="#comment-all--ignores">Comment all // ignores</a></li><li><a href="#comment-all-test-skips">Comment all test skips</a></li><li><a href="#comment-empty-closures-to-setstate">Comment empty closures to setState</a></li></ul></li><li><a href="#formatting">Formatting</a><ul><li><a href="#in-defense-of-the-extra-work-that-hand-formatting-entails">In defense of the extra work that hand-formatting entails</a></li><li><a href="#constructors-come-first-in-a-class">Constructors come first in a class</a></li><li><a href="#order-other-class-members-in-a-way-that-makes-sense">Order other class members in a way that makes sense</a></li><li><a href="#constructor-syntax">Constructor syntax</a></li><li><a href="#prefer-a-maximum-line-length-of-80-characters">Prefer a maximum line length of 80 characters</a></li><li><a href="#indent-multi-line-argument-and-parameter-lists-by-2-characters">Indent multi-line argument and parameter lists by 2 characters</a></li><li><a href="#if-you-have-a-newline-after-some-opening-punctuation-match-it-on-the-closing-punctuation">If you have a newline after some opening punctuation, match it on the closing punctuation.</a></li><li><a href="#use-a-trailing-comma-for-arguments-parameters-and-list-items-but-only-if-they-each-have-their-own-line">Use a trailing comma for arguments, parameters, and list items, but only if they each have their own line.</a></li><li><a href="#prefer-single-quotes-for-strings">Prefer single quotes for strings</a></li><li><a href="#consider-using--for-short-functions-and-methods">Consider using =&gt; for short functions and methods</a></li><li><a href="#use--for-inline-callbacks-that-just-return-literals-or-switch-expressions">Use =&gt; for inline callbacks that just return literals or switch expressions</a></li><li><a href="#prefer-single-line-for-short-collection-if-and-collection-for">Prefer single line for short collection-if and collection-for</a></li><li><a href="#put-spread-inside-collection-if-or-collection-for-on-the-same-line">Put spread inside collection-if or collection-for on the same line</a></li><li><a href="#use-braces-for-long-functions-and-methods">Use braces for long functions and methods</a></li><li><a href="#separate-the-if-expression-from-its-statement">Separate the 'if' expression from its statement</a></li><li><a href="#align-expressions">Align expressions</a></li><li><a href="#prefer--over-">Prefer = over +</a></li><li><a href="#use-double-literals-for-double-constants">Use double literals for double constants</a></li></ul></li><li><a href="#conventions">Conventions</a><ul><li><a href="#expectations-around-potential-crashes-in-the-engine">Expectations around potential crashes in the engine</a></li><li><a href="#features-we-expect-every-widget-to-implement">Features we expect every widget to implement</a></li><li><a href="#use-of-streams-in-flutter-framework-code">Use of streams in Flutter framework code</a></li></ul></li><li><a href="#packages">Packages</a><ul><li><p><a href="#structure">Structure</a></p></li><li><p><a href="#import-conventions">Import conventions</a></p></li><li><p><a href="#deciding-where-to-put-code">Deciding where to put code</a></p></li><li><p><a href="#layers">Layers</a></p></li><li><p><a href="#avoid-interleaving-multiple-concepts-together">Avoid interleaving multiple concepts together</a></p></li><li><p><a href="#avoid-secret-or-global-state">Avoid secret (or global) state</a></p></li><li><p><a href="#prefer-general-apis-but-use-dedicated-apis-where-there-is-a-reason">Prefer general APIs, but use dedicated APIs where there is a reason</a></p></li><li><p><a href="#avoid-the-lowest-common-denominator">Avoid the lowest common denominator</a></p></li><li><p><a href="#avoid-apis-that-encourage-bad-practices">Avoid APIs that encourage bad practices</a></p></li><li><p><a href="#avoid-exposing-api-cliffs">Avoid exposing API cliffs</a></p></li><li><p><a href="#avoid-exposing-api-oceans">Avoid exposing API oceans</a></p></li><li><p><a href="#avoid-heuristics-and-magic">Avoid heuristics and magic</a></p></li><li><p><a href="#solve-real-problems-by-literally-solving-a-real-problem">Solve real problems by literally solving a real problem</a></p></li><li><p><a href="#get-early-feedback-when-designing-new-apis">Get early feedback when designing new APIs</a></p></li><li><p><a href="#start-designing-apis-from-the-closest-point-to-the-developer">Start designing APIs from the closest point to the developer</a></p></li><li><p><a href="#only-log-actionable-messages-to-the-console">Only log actionable messages to the console</a></p></li><li><p><a href="#error-messages-should-be-useful">Error messages should be useful</a></p></li><li><p><a href="#template-values-should-set-developers-up-for-success">Template values should set developers up for success</a></p></li></ul></li><li><a href="#policies">Policies</a><ul><li><a href="#plugin-compatibility">Plugin compatibility</a></li><li><a href="#workarounds">Workarounds</a></li><li><a href="#avoid-abandonware">Avoid abandonware</a></li><li><a href="#widget-libraries-follow-the-latest-oem-behavior">Widget libraries follow the latest OEM behavior</a></li><li><a href="#code-that-is-not-copyrighted-the-flutter-authors">Code that is not copyrighted &quot;The Flutter Authors&quot;</a></li></ul></li><li><a href="#documentation-dartdocs-javadocs-etc">Documentation (dartdocs, javadocs, etc)</a><ul><li><a href="#answer-your-own-questions-straight-away">Answer your own questions straight away</a></li><li><a href="#avoid-useless-documentation">Avoid useless documentation</a></li><li><a href="#writing-prompts-for-good-documentation">Writing prompts for good documentation</a></li><li><a href="#introduce-terms-as-if-every-piece-of-documentation-is-the-first-the-reader-has-ever-seen">Introduce terms as if every piece of documentation is the first the reader has ever seen</a></li><li><a href="#avoid-empty-prose">Avoid empty prose</a></li><li><a href="#leave-breadcrumbs-in-the-comments">Leave breadcrumbs in the comments</a></li><li><a href="#refactor-the-code-when-the-documentation-would-be-incomprehensible">Refactor the code when the documentation would be incomprehensible</a></li><li><a href="#canonical-terminology">Canonical terminology</a></li><li><a href="#use-correct-grammar">Use correct grammar</a></li><li><a href="#use-the-passive-voice-recommend-do-not-require-never-say-things-are-simple">Use the passive voice; recommend, do not require; never say things are simple</a></li><li><a href="#provide-sample-code">Provide sample code</a></li><li><a href="#provide-illustrations-diagrams-or-screenshots">Provide illustrations, diagrams or screenshots</a></li><li><a href="#link-to-widget-of-the-week-videos">Link to Widget of the Week videos</a></li><li><a href="#clearly-mark-deprecated-apis">Clearly mark deprecated APIs</a></li><li><a href="#use--for-public-quality-private-documentation">Use /// for public-quality private documentation</a></li><li><a href="#dartdoc-templates-and-macros">Dartdoc templates and macros</a></li><li><a href="#dartdoc-specific-requirements">Dartdoc-specific requirements</a></li></ul></li><li><a href="#coding-patterns-and-catching-bugs-early">Coding patterns and catching bugs early</a><ul><li><a href="#use-asserts-liberally-to-detect-contract-violations-and-verify-invariants">Use asserts liberally to detect contract violations and verify invariants</a></li><li><a href="#prefer-specialized-functions-methods-and-constructors">Prefer specialized functions, methods and constructors</a></li><li><a href="#minimize-the-visibility-scope-of-constants">Minimize the visibility scope of constants</a></li><li><a href="#avoid-using-if-chains-or--or--with-enum-values">Avoid using if chains or ?: or == with enum values</a></li><li><a href="#avoid-using-var-and-dynamic">Avoid using var and dynamic</a></li><li><a href="#avoid-using-library-and-part-of">Avoid using library and part of.</a></li><li><a href="#avoid-using-extension">Avoid using extension.</a></li><li><a href="#avoid-using-futureort">Avoid using FutureOr<t></t></a></li><li><a href="#avoid-using-expando">Avoid using Expando</a></li><li><a href="#avoid-using-visiblefortesting">Avoid using @visibleForTesting</a></li><li><a href="#never-check-if-a-port-is-available-before-using-it-never-add-timeouts-and-other-race-conditions">Never check if a port is available before using it, never add timeouts, and other race conditions.</a></li><li><a href="#avoid-mysterious-and-magical-numbers-that-lack-a-clear-derivation">Avoid mysterious and magical numbers that lack a clear derivation</a></li><li><a href="#have-good-hygiene-when-using-temporary-directories">Have good hygiene when using temporary directories</a></li><li><a href="#perform-dirty-checks-in-setters">Perform dirty checks in setters</a></li><li><a href="#common-boilerplates-for-operator--and-hashcode">Common boilerplates for operator == and hashCode</a></li><li><a href="#override-tostring">Override toString</a></li><li><a href="#be-explicit-about-dispose-and-the-object-lifecycle">Be explicit about dispose() and the object lifecycle</a></li><li><a href="#test-apis-belong-in-the-test-frameworks">Test APIs belong in the test frameworks</a></li><li><a href="#immutable-classes-should-not-have-hidden-state">Immutable classes should not have hidden state</a></li><li><a href="#avoid-syncasync">Avoid sync*/async*</a></li></ul></li><li><a href="#writing-tests">Writing tests</a><ul><li><a href="#make-each-test-entirely-self-contained">Make each test entirely self-contained</a></li><li><a href="#prefer-more-test-files-avoid-long-test-files">Prefer more test files, avoid long test files</a></li><li><a href="#avoid-using-pumpandsettle">Avoid using pumpAndSettle</a></li></ul></li><li><a href="#naming">Naming</a><ul><li><a href="#begin-global-constant-names-with-prefix-k">Begin global constant names with prefix &quot;k&quot;</a></li><li><a href="#avoid-abbreviations">Avoid abbreviations</a></li><li><a href="#avoid-anonymous-parameter-names">Avoid anonymous parameter names</a></li><li><a href="#naming-rules-for-typedefs-and-function-variables">Naming rules for typedefs and function variables</a></li><li><a href="#spell-words-in-identifiers-and-comments-correctly">Spell words in identifiers and comments correctly</a></li><li><a href="#capitalize-identifiers-consistent-with-their-spelling">Capitalize identifiers consistent with their spelling</a></li><li><a href="#avoid-double-negatives-in-apis">Avoid double negatives in APIs</a></li><li><a href="#prefer-naming-the-argument-to-a-setter-value">Prefer naming the argument to a setter value</a></li><li><a href="#qualify-variables-and-methods-used-only-for-debugging">Qualify variables and methods used only for debugging</a></li><li><a href="#avoid-naming-undocumented-libraries">Avoid naming undocumented libraries</a></li><li><a href="#avoid-newold-modifiers-in-code">Avoid &quot;new/old&quot; modifiers in code</a></li></ul></li><li><a href="#comments">Comments</a><ul><li><a href="#avoid-checking-in-comments-that-ask-questions">Avoid checking in comments that ask questions</a></li><li><a href="#comment-all--ignores">Comment all // ignores</a></li><li><a href="#comment-all-test-skips">Comment all test skips</a></li><li><a href="#comment-empty-closures-to-setstate">Comment empty closures to setState</a></li></ul></li><li><a href="#formatting">Formatting</a><ul><li><a href="#in-defense-of-the-extra-work-that-hand-formatting-entails">In defense of the extra work that hand-formatting entails</a></li><li><a href="#constructors-come-first-in-a-class">Constructors come first in a class</a></li><li><a href="#order-other-class-members-in-a-way-that-makes-sense">Order other class members in a way that makes sense</a></li><li><a href="#constructor-syntax">Constructor syntax</a></li><li><a href="#prefer-a-maximum-line-length-of-80-characters">Prefer a maximum line length of 80 characters</a></li><li><a href="#indent-multi-line-argument-and-parameter-lists-by-2-characters">Indent multi-line argument and parameter lists by 2 characters</a></li><li><a href="#if-you-have-a-newline-after-some-opening-punctuation-match-it-on-the-closing-punctuation">If you have a newline after some opening punctuation, match it on the closing punctuation.</a></li><li><a href="#use-a-trailing-comma-for-arguments-parameters-and-list-items-but-only-if-they-each-have-their-own-line">Use a trailing comma for arguments, parameters, and list items, but only if they each have their own line.</a></li><li><a href="#prefer-single-quotes-for-strings">Prefer single quotes for strings</a></li><li><a href="#consider-using--for-short-functions-and-methods">Consider using =&gt; for short functions and methods</a></li><li><a href="#use--for-inline-callbacks-that-just-return-literals-or-switch-expressions">Use =&gt; for inline callbacks that just return literals or switch expressions</a></li><li><a href="#prefer-single-line-for-short-collection-if-and-collection-for">Prefer single line for short collection-if and collection-for</a></li><li><a href="#put-spread-inside-collection-if-or-collection-for-on-the-same-line">Put spread inside collection-if or collection-for on the same line</a></li><li><a href="#use-braces-for-long-functions-and-methods">Use braces for long functions and methods</a></li><li><a href="#separate-the-if-expression-from-its-statement">Separate the 'if' expression from its statement</a></li><li><a href="#align-expressions">Align expressions</a></li><li><a href="#prefer--over-">Prefer = over +</a></li><li><a href="#use-double-literals-for-double-constants">Use double literals for double constants</a></li></ul></li><li><a href="#conventions">Conventions</a><ul><li><a href="#expectations-around-potential-crashes-in-the-engine">Expectations around potential crashes in the engine</a></li><li><a href="#features-we-expect-every-widget-to-implement">Features we expect every widget to implement</a></li><li><a href="#use-of-streams-in-flutter-framework-code">Use of streams in Flutter framework code</a></li></ul></li><li><a href="#packages">Packages</a><ul><li><a href="#structure">Structure</a></li><li><a href="#import-conventions">Import conventions</a></li><li><a href="#deciding-where-to-put-code">Deciding where to put code</a></li></ul></li></ul><h2 id="overview">Overview</h2><p>This document describes our approach to designing and programming Flutter, from high-level architectural principles all the way to indentation rules. These are our norms, written down so that we can easily convey our shared understanding with new team members.</p><p>The primary goal of these style guidelines is to improve code readability so that everyone, whether reading the code for the first time or maintaining it for years, can quickly determine what the code does. Secondary goals are to design systems that are simple, to increase the likelihood of catching bugs quickly, and avoiding arguments when there are disagreements over subjective matters.</p><p>For anything not covered by this document, check the <a href="https://www.dartlang.org/guides/language/effective-dart/">Dart style guide</a> for more advice. That document is focused primarily on Dart-specific conventions, while this document is more about Flutter conventions.</p><p>In some cases (for example, line wrapping around <code>if</code> statements) the Dart style guide differs from the Flutter guide. For Flutter project code, the Flutter guide governs. The differences are a result of slightly different priorities. The Flutter guide is designed for making code highly readable even to people who have never seen the code before and are new to Dart, as the Flutter framework code will be read millions of times more than it is written. The Dart guide, on the other hand, is designed to provide a more balanced approach that assumes that the writing of the code will be a bigger proportion of the interactions with the code, and that the reader is more experienced with Dart. (The <code>dart format</code> tool uses the Dart guide, so we do not use it in the flutter/flutter and flutter/engine repositories. However, we do recommend its use in general.)</p><h3 id="a-word-on-designing-apis">A word on designing APIs</h3><p>Designing an API is an art. Like all forms of art, one learns by practicing. The best way to get good at designing APIs is to spend a decade or more designing them, while working closely with people who are using your APIs. Ideally, one would first do this in very controlled situations, with small numbers of developers using one’s APIs, before graduating to writing APIs that will be used by hundreds of thousands or even millions of developers.</p><p>In the absence of one’s own experience, one can attempt to rely on the experience of others. The biggest problem with this is that sometimes explaining why an API isn’t optimal is a very difficult and subtle task, and sometimes the reasoning doesn’t sound convincing unless you already have a lot of experience designing them.</p><p>Because of this, and contrary to almost any other situation in engineering, when you are receiving feedback about API design from an experienced API designer, they will sometimes seem unhappy without quite being able to articulate why. When this happens, seriously consider that your API should be scrapped and a new solution found.</p><p>This requires a different and equally important skill when designing APIs: not getting attached to one’s creations. One should try many wildly different APIs, and then attempt to write code that uses those APIs, to see how they work. Throw away APIs that feel frustrating, that lead to buggy code, or that other people don’t like. If it isn’t elegant, it’s usually better to try again than to forge ahead.</p><p>An API is for life, not just for the one PR you are working on.</p><h2 id="philosophy">Philosophy</h2><h3 id="lazy-programming">Lazy programming</h3><p>Write what you need and no more, but when you write it, do it right.</p><p>Avoid implementing features you don’t need. You can’t design a feature without knowing what the constraints are. Implementing features &quot;for completeness&quot; results in unused code that is expensive to maintain, learn about, document, test, etc.</p><p>When you do implement a feature, implement it the right way. Avoid workarounds. Workarounds merely kick the problem further down the road, but at a higher cost: someone will have to relearn the problem, figure out the workaround and how to dismantle it (and all the places that now use it), <em>and</em> implement the feature. It’s much better to take longer to fix a problem properly, than to be the one who fixes everything quickly but in a way that will require cleaning up later.</p><p>You may hear team members say &quot;embrace the http://www.catb.org/jargon/html/Y/yak-shaving.html[yak shave]!&quot;. This is an encouragement to <a href="https://www.youtube.com/watch?v=AbSehcT19u0">take on the larger effort necessary</a> to perform a proper fix for a problem rather than just applying a band-aid.</p><h3 id="write-test%2C-find-bug">Write Test, Find Bug</h3><p>When you fix a bug, first write a test that fails, then fix the bug and verify the test passes.</p><p>When you implement a new feature, write tests for it. (See also: <a href="https://github.com/flutter/flutter/wiki/Running-and-writing-tests">Running and writing tests</a>, and the section on writing tests below.)</p><p>Check the code coverage to make sure every line of your new code is tested. See also: <a href="https://github.com/flutter/flutter/wiki/Test-coverage-for-package%3Aflutter">Test coverage for package:flutter</a>.</p><p>If something isn’t tested, it is very likely to regress or to get &quot;optimized away&quot;. If you want your code to remain in the codebase, you should make sure to test it.</p><p>Don’t submit code with the promise to &quot;write tests later&quot;. Just take the time to write the tests properly and completely in the first place.</p><h3 id="avoid-duplicating-state">Avoid duplicating state</h3><p>There should be no objects that represent live state that reflect some state from another source, since they are expensive to maintain. (The Web’s <code>HTMLCollection</code> object is an example of such an object.) In other words, <em><strong>keep only one source of truth</strong></em>, and <strong>don’t replicate live state</strong>.</p><h3 id="getters-feel-faster-than-methods">Getters feel faster than methods</h3><p>Property getters should be efficient (e.g. just returning a cached value, or an O(1) table lookup). If an operation is inefficient, it should be a method instead. (Looking at the Web again: we would have <code>document.getForms()</code>, not <code>document.forms</code>, since it walks the entire tree).</p><p>Similarly, a getter that returns a Future should not kick-off the work represented by the future, since getters appear idempotent and side-effect free. Instead, the work should be started from a method or constructor, and the getter should just return the preexisting Future.</p><h3 id="no-synchronous-slow-work">No synchronous slow work</h3><p>There should be no APIs that require synchronously completing an expensive operation (e.g. computing a full app layout outside of the layout phase). Expensive work should be asynchronous.</p><h3 id="layers">Layers</h3><p>We use a layered framework design, where each layer addresses a narrowly scoped problem and is then used by the next layer to solve a bigger problem. This is true both at a high level (widgets relies on rendering relies on painting) and at the level of individual classes and methods (e.g. <code>Text</code> uses <code>RichText</code> and <code>DefaultTextStyle</code>).</p><p>Convenience APIs belong at the layer above the one they are simplifying.</p><h3 id="avoid-interleaving-multiple-concepts-together">Avoid interleaving multiple concepts together</h3><p>Each API should be self-contained and should not know about other features. Interleaving concepts leads to <em>complexity</em>.</p><p>For example:</p><ul><li>Many Widgets take a <code>child</code>. Widgets should be entirely agnostic about the type of that child. Don’t use <code>is</code> or similar checks to act differently based on the type of the child.</li><li>Render objects each solve a single problem. Rather than having a render object handle both clipping and opacity, we have one render object for clipping, and one for opacity.</li><li>In general, prefer immutable objects over mutable data. Immutable objects can be passed around safely without any risk that a downstream consumer will change the data. (Sometimes, in Flutter, we pretend that some objects are immutable even when they technically are not: for example, widget child lists are often technically implemented by mutable <code>List</code> instances, but the framework will never modify them and in fact cannot handle the user modifying them.) Immutable data also turns out to make animations much simpler through <em>lerping</em>.</li></ul><h3 id="avoid-secret-(or-global)-state">Avoid secret (or global) state</h3><p>A function should operate only on its arguments and, if it is an instance method, data stored on its object. This makes the code significantly easier to understand.</p><p>For example, when reading this code:</p><pre class="prettyprint source lang-dart"><code>
void main() {
  foo(1);
  bar(2);
}
</code></pre><p>...the reader should be confident that nothing in the call to <code>foo</code> could affect anything in the call to <code>bar</code>.</p><p>This usually means structuring APIs so that they either take all relevant inputs as arguments, or so that they are based on objects that are created with the relevant input, and can then be called to operate on those inputs.</p><p>This significantly aids in making code testable and in making code understandable and debuggable. When code operates on secret global state, it’s much harder to reason about.</p><h3 id="prefer-general-apis%2C-but-use-dedicated-apis-where-there-is-a-reason">Prefer general APIs, but use dedicated APIs where there is a reason</h3><p>For example, having dedicated APIs for performance reasons is fine. If one specific operation, say clipping a rounded rectangle, is expensive using the general API but could be implemented more efficiently using a dedicated API, then that is where we would create a dedicated API.</p><h3 id="avoid-the-lowest-common-denominator">Avoid the lowest common denominator</h3><p>It is common for SDKs that target multiple platforms (or meta-platforms that themselves run on multiple platforms, like the Web) to provide APIs that work on all their target platforms. Unfortunately, this usually means that features that are unique to one platform or another are unavailable.</p><p>For Flutter, we want to avoid this by explicitly aiming to be the best way to develop for each platform individually. Our ability to be used cross- platform is secondary to our ability to be used on each platform. For example, <a href="https://master-api.flutter.dev/flutter/services/TextInputAction-class.html">TextInputAction</a> has values that only make sense on some platforms. Similarly, our platform channel mechanism is designed to allow separate extensions to be created on each platform.</p><h3 id="avoid-apis-that-encourage-bad-practices">Avoid APIs that encourage bad practices</h3><p>For example, don’t provide APIs that walk entire trees, or that encourage O(N^2) algorithms, or that encourage sequential long-lived operations where the operations could be run concurrently.</p><p>In particular:</p><ul><li>String manipulation to generate data or code that will subsequently be interpreted or parsed is a bad practice as it leads to code injection vulnerabilities.</li><li>If an operation is expensive, that expense should be represented in the API (e.g. by returning a <code>Future</code> or a <code>Stream</code>). Avoid providing APIs that hide the expense of tasks.</li></ul><h3 id="avoid-exposing-api-cliffs">Avoid exposing API cliffs</h3><p>Convenience APIs that wrap some aspect of a service from one environment for exposure in another environment (for example, exposing an Android API in Dart), should expose/wrap the complete API, so that there’s no cognitive cliff when interacting with that service (where you are fine using the exposed API up to a point, but beyond that have to learn all about the underlying service).</p><h3 id="avoid-exposing-api-oceans">Avoid exposing API oceans</h3><p>APIs that wrap underlying services but prevent the underlying API from being directly accessed (e.g. how <code>dart:ui</code> exposes Skia) should carefully expose only the best parts of the underlying API. This may require refactoring features so that they are more usable. It may mean avoiding exposing convenience features that abstract over expensive operations unless there’s a distinct performance gain from doing so. A smaller API surface is easier to understand.</p><p>For example, this is why <code>dart:ui</code> doesn’t expose <code>Path.fromSVG()</code>: we checked, and it is just as fast to do that work directly in Dart, so there is no benefit to exposing it. That way, we avoid the costs (bigger API surfaces are more expensive to maintain, document, and test, and put a compatibility burden on the underlying API).</p><h3 id="avoid-heuristics-and-magic">Avoid heuristics and magic</h3><p>Predictable APIs that the developer feels gives them control are generally preferred over APIs that mostly do the right thing but don’t give the developer any way to adjust the results.</p><p>Predictability is reassuring.</p><h3 id="solve-real-problems-by-literally-solving-a-real-problem">Solve real problems by literally solving a real problem</h3><p>Where possible, especially for new features, you should partner with a real customer who wants that feature and is willing to help you test it. Only by actually using a feature in the real world can we truly be confident that a feature is ready for prime time.</p><p>Listen to their feedback, too. If your first customer is saying that your feature doesn’t actually solve their use case completely, don’t dismiss their concerns as esoteric. Often, what seems like the problem when you start a project turns out to be a trivial concern compared to the real issues faced by real developers.</p><h3 id="get-early-feedback-when-designing-new-apis">Get early feedback when designing new APIs</h3><p>If you’re designing a new API or a new feature, consider <a href="https://github.com/flutter/flutter/wiki/Chat#design-documents">writing a design doc</a>. Then, get feedback from the relevant people, e.g. send it to <code>flutter-dev</code> or post it on the <a href="https://github.com/flutter/flutter/wiki/Chat#existing-channels">relevant chat channel</a>.</p><h3 id="start-designing-apis-from-the-closest-point-to-the-developer">Start designing APIs from the closest point to the developer</h3><p>When we create a new feature that requires a change to the entire stack, it’s tempting to design the lowest-level API first, since that’s the closest to the &quot;interesting&quot; code (the &quot;business end&quot; of the feature, where we actually do the work). However, that then forces the higher level APIs to be designed against the lower-level API, which may or may not be a good fit, and eventually the top-level API, which developers will primarily be using, may be forced to be a tortured and twisted mess (either in implementation or in terms of the exposed API). It may even be that the final API doesn’t fit how people think about the problem or solve their actual issues, but instead merely exposes the lowest-level feature almost verbatim.</p><p>Instead, always design the top-level API first. Consider what the most ergonomic API would be at the level that most developers will be interacting with it. Then, once that API is cleanly designed and usability-tested, build the lower levels so that the higher level can be layered atop.</p><p>Concretely, this means designing the API at the <code>material</code> or <code>widgets</code> layer first, then the API in the <code>rendering</code>, <code>scheduler</code>, or <code>services</code> layer, then the relevant binding, then the <code>dart:ui</code> API or the message channel protocol, then the internal engine API or the plugin API. (The details may vary from case to case.)</p><h3 id="only-log-actionable-messages-to-the-console">Only log actionable messages to the console</h3><p>If the logs contain messages that the user can safely ignore, then they will do so, and eventually their logs will be so chatty and verbose that they will miss the critical messages. Therefore, only log actual errors and actionable warnings (warnings that can always be dealt with and fixed).</p><p>Never log &quot;informational&quot; messages by default. It is possible that it may be useful to have messages on certain topics while debugging those topics. To deal with that, have debug flags you can enable that enable extra logging for particular topics. For example, setting <code>debugPrintLayouts</code> to true enables logging of layouts.</p><p>This also applies to our unopt builds. It’s annoying for other people on the team to have to wade through messages that aren’t directly relevant to their work. Rely on feature flags, not verbosity levels, when deciding to output messages. The one exception to this is reporting useful milestones; for example, the <code>flutter</code> tool in verbose mode (<code>-v</code>) reports meaningful steps that it is executing because those are almost always useful.</p><h3 id="error-messages-should-be-useful">Error messages should be useful</h3><p>Every time you find the need to report an error (e.g. throwing an exception in the framework, handling some bad state in the engine, reporting a syntax error in the Dart compiler, etc), consider how you can make this the most useful and helpful error message ever.</p><p>Put yourself in the shoes of whoever sees that error message. Why did they see it? What can we do to help them? They are at a crossroads, having seen your error message: they can either get frustrated and hate Flutter, or they can feel thankful that the error helped them resolve an actual issue. <em><strong>Every error message is an opportunity to make someone love our product.</strong></em></p><h3 id="template-values-should-set-developers-up-for-success">Template values should set developers up for success</h3><p>Template defaults should focus on providing the best developer experience. Templates should help developers understand the code, be easy to run now and support in the future. Help developers by picking dependencies that are broadly used and/or broadly supported and by leaving <a href="https://github.com/flutter/flutter/wiki/Style-guide-for-Flutter-repo#leave-breadcrumbs-in-the-comments">comments that are helpful</a>.</p><p>See flutter create’s templates for an example.</p><h2 id="policies">Policies</h2><p>This section defines some policies that we have decided to honor. In the absence of a very specific policy in this section, the general philosophies in the section above are controlling.</p><h3 id="plugin-compatibility">Plugin compatibility</h3><p>We guarantee that a plugin published with a version equal to or greater than 1.0.0 will require no more recent a version of Flutter than the latest stable release at the time that the plugin was released. (Plugins may support older versions too, but that is not guaranteed.)</p><h3 id="workarounds">Workarounds</h3><p>We are willing to implement temporary (one week or less) workarounds (e.g. <code>//ignore</code> hacks) if it helps a high profile developer or prolific contributor with a painful transition. Please contact @Hixie (ian@hixie.ch) if you need to make use of this option.</p><h3 id="avoid-abandonware">Avoid abandonware</h3><p>Code that is no longer maintained should be deleted or archived in some way that clearly indicates that it is no longer maintained.</p><p>For example, we delete rather than commenting out code. Commented-out code will bitrot too fast to be useful, and will confuse people maintaining the code.</p><p>Similarly, all our repositories should have an owner that does regular triage of incoming issues and PRs, and fixes known issues. Repositories where nobody is doing triage at least monthly, preferably more often, should be deleted, hidden, or otherwise archived.</p><h3 id="widget-libraries-follow-the-latest-oem-behavior">Widget libraries follow the latest OEM behavior</h3><p>For our material and cupertino libraries, we generally implement the latest behavior unless doing so would be a seriously disruptive breaking change. For example, we use the latest stylings for iOS switch controls, but when Material Design introduced a whole new type of button, we created a new widget for that rather than updating the existing buttons to have the new style.</p><h3 id="code-that-is-not-copyrighted-%22the-flutter-authors%22">Code that is not copyrighted &quot;The Flutter Authors&quot;</h3><p>All code in all Flutter repositories must be contributed by developers who have signed <a href="https://cla.developers.google.com/">the Google CLA</a>, and must be licensed using our normal BSD license with a copyright referencing &quot;The Flutter Authors&quot;, except if it is &quot;third party code&quot;.</p><p>&quot;Third party code&quot; that is not part of a Dart package must be in a subdirectory of a <code>third_party</code> directory at the root of the relevant repository, and the subdirectory in question must contain a <code>LICENSE</code> file that details the license covering that code and a <code>README</code> describing the provenance of that code.</p><p>&quot;Third party code&quot; that is part of a Dart package and is not Dart code must be in a subdirectory of a <code>third_party</code> directory at the root of the package, and the subdirectory in question must contain a <code>LICENSE</code> file that details the license covering that code and a <code>README</code> describing the provenance of that code. The license must then also be duplicated into the package’s <code>LICENSE</code> file using the syntax described in the <a href="https://master-api.flutter.dev/flutter/foundation/LicenseRegistry-class.html">LicenseRegistry</a> API docs.</p><p>&quot;Third party code&quot; that is part of a Dart package and is Dart code must be in a subdirectory of the package’s <code>lib/src/third_party</code> directory, and the subdirectory in question must contain a <code>LICENSE</code> file that details the license covering that code and a <code>README</code> describing the provenance of that code. The license must then also be duplicated into the package’s <code>LICENSE</code> file using the syntax described in the <a href="https://master-api.flutter.dev/flutter/foundation/LicenseRegistry-class.html">LicenseRegistry</a> API docs.</p><p>All licenses included in this manner must have been reviewed and determined to be legally acceptable licenses.</p><p>All such &quot;third party code&quot; must either be a fork for which we take full responsibility, or there must be an automated rolling mechanism that keeps the code up to date when the upstream source changes.</p><p>In general it is <em>strongly</em> recommended that we avoid any such code unless strictly necessary. In particular, we aim for all code in the flutter/flutter repository to be <a href="https://github.com/flutter/flutter/wiki/Why-we-have-a-separate-engine-repo#licensing?">single-licensed</a>, which is why it does not contain any &quot;third party code&quot; at all.</p><h2 id="documentation-(dartdocs%2C-javadocs%2C-etc)">Documentation (dartdocs, javadocs, etc)</h2><p>We use &quot;dartdoc&quot; for our Dart documentation, and similar technologies for the documentation of our APIs in other languages, such as ObjectiveC and Java. All public members in Flutter libraries should have a documentation.</p><p>In general, follow the <a href="https://www.dartlang.org/effective-dart/documentation/#doc-comments">Dart documentation guide</a> except where that would contradict this page.</p><h3 id="answer-your-own-questions-straight-away">Answer your own questions straight away</h3><p>When working on Flutter, if you find yourself asking a question about our systems, please place whatever answer you subsequently discover into the documentation in the same place where you first looked for the answer. That way, the documentation will consist of answers to real questions, where people would look to find them. Do this right away; it’s fine if your otherwise-unrelated PR has a bunch of documentation fixes in it to answer questions you had while you were working on your PR.</p><p>We try to avoid reliance on &quot;oral tradition&quot;. It should be possible for anyone to begin contributing without having had to learn all the secrets from existing team members. To that end, all processes should be documented (typically on the wiki), code should be self-explanatory or commented, and conventions should be written down, e.g. in our style guide.</p><p>There is one exception: it’s better to <em>not</em> document something in our API docs than to document it poorly. This is because if you don’t document it, it still appears on our list of things to document. Feel free to remove documentation that violates our rules below (especially the next one), so as to make it reappear on the list.</p><h3 id="avoid-useless-documentation">Avoid useless documentation</h3><p>If someone could have written the same documentation without knowing anything about the class other than its name, then it’s useless.</p><p>Avoid checking in such documentation, because it is no better than no documentation but will prevent us from noticing that the identifier is not actually documented.</p><p>Example (from <a href="http://docs.flutter.io/flutter/material/CircleAvatar-class.html"><code>CircleAvatar</code></a>):</p><pre class="prettyprint source lang-dart"><code>
final Color backgroundColor;

final double radius;

final Color backgroundColor;

final double radius;
</code></pre><h3 id="writing-prompts-for-good-documentation">Writing prompts for good documentation</h3><p>If you are having trouble coming up with useful documentation, here are some prompts that might help you write more detailed prose:</p><ul><li>If someone is looking at this documentation, it means that they have a question which they couldn’t answer by guesswork or by looking at the code. What could that question be? Try to answer all questions you can come up with.</li><li>If you were telling someone about this property, what might they want to know that they couldn’t guess? For example, are there edge cases that aren’t intuitive?</li><li>Consider the type of the property or arguments. Are there cases that are outside the normal range that should be discussed? e.g. negative numbers, non-integer values, transparent colors, empty arrays, infinities, NaN, null? Discuss any that are non-trivial.</li><li>Does this member interact with any others? For example, can it only be non-null if another is null? Will this member only have any effect if another has a particular range of values? Will this member affect whether another member has any effect, or what effect another member has?</li><li>Does this member have a similar name or purpose to another, such that we should point to that one, and from that one to this one? Use the <code>See also:</code> pattern.</li><li>Are there timing considerations? Any potential race conditions?</li><li>Are there lifecycle considerations? For example, who owns the object that this property is set to? Who should <code>dispose()</code> it, if that’s relevant?</li><li>What is the contract for this property/method? Can it be called at any time? Are there limits on what values are valid? If it’s a <code>final</code> property set from a constructor, does the constructor have any limits on what the property can be set to? If this is a constructor, are any of the arguments not nullable?</li><li>If there are <code>Future</code> values involved, what are the guarantees around those? Consider whether they can complete with an error, whether they can never complete at all, what happens if the underlying operation is canceled, and so forth.</li></ul><h3 id="introduce-terms-as-if-every-piece-of-documentation-is-the-first-the-reader-has-ever-seen">Introduce terms as if every piece of documentation is the first the reader has ever seen</h3><p>It’s easy to assume that the reader has some basic knowledge of Dart or Flutter when writing API documentation.</p><p>Unfortunately, the reality is that everyone starts knowing nothing, and we do not control where they will begin their journey.</p><p>For this reason, avoid using terms without first defining them, unless you are linking to more fundamental documentation that defines that term without reference to the API you are documenting.</p><p>For example, a fancy widget in the Material library can refer to the <code>StatefulWidget</code> documentation and assume that the reader either knows about the <code>StatefulWidget</code> class, or can learn about it by following the link and then later returning to the documentation for the fancy widget. However, the documentation for the <code>StatefulWidget</code> class should avoid assuming that the reader knows what a <code>State</code> class is, and should avoid defering to it for its definition, because <code>State</code> could is likely to defer back to <code>StatefulWidget</code> and the reader would be stuck in a loop unable to grasp the basic principles. This is the documentation equivalent of a bootstrapping problem.</p><p>Another way to express this is that API documentation should follow a similar layering philosophy as code. The goal of documentation is not just to act as a refresher for experts, but to act as a tutorial for new developers.</p><h3 id="avoid-empty-prose">Avoid empty prose</h3><p>It’s easy to use more words than necessary. Avoid doing so where possible, even if the result is somewhat terse.</p><pre class="prettyprint source lang-dart"><code>
</code></pre><p>In particular, avoid saying &quot;Note:&quot;, or starting a sentence with &quot;Note that&quot;. It adds nothing.</p><h3 id="leave-breadcrumbs-in-the-comments">Leave breadcrumbs in the comments</h3><p>This is especially important for documentation at the level of classes.</p><p>If a class is constructed using a builder of some sort, or can be obtained via some mechanism other than merely calling the constructor, then include this information in the documentation for the class.</p><p>If a class is typically used by passing it to a particular API, then include that information in the class documentation also.</p><p>If a method is the main mechanism used to obtain a particular object, or is the main way to consume a particular object, then mention that in the method’s description.</p><p>Typedefs should mention at least one place where the signature is used.</p><p>These rules result in a chain of breadcrumbs that a reader can follow to get from any class or method that they might think is relevant to their task all the way up to the class or method they actually need.</p><p>Example:</p><pre class="prettyprint source lang-dart"><code>
abstract class Picture ...
</code></pre><p>You can also use &quot;See also&quot; links, is in:</p><pre class="prettyprint source lang-dart"><code></code></pre><p>Each line should end with a period. Prefer &quot;which...&quot; rather than parentheticals on such lines. There should be a blank line between &quot;See also:&quot; and the first item in the bulleted list.</p><h3 id="refactor-the-code-when-the-documentation-would-be-incomprehensible">Refactor the code when the documentation would be incomprehensible</h3><p>If writing the documentation proves to be difficult because the API is convoluted, then rewrite the API rather than trying to document it.</p><h3 id="canonical-terminology">Canonical terminology</h3><p>The documentation should use consistent terminology:</p><ul><li><em>method</em> - a member of a class that is a non-anonymous closure</li><li><em>function</em> - a callable non-anonymous closure that isn’t a member of a class</li><li><em>parameter</em> - a variable defined in a closure signature and possibly used in the closure body.</li><li><em>argument</em> - the value passed to a closure when calling it.</li></ul><p>Prefer the term &quot;call&quot; to the term &quot;invoke&quot; when talking about jumping to a closure.</p><p>Prefer the term &quot;member variable&quot; to the term &quot;instance variable&quot; when talking about variables associated with a specific object.</p><p>Typedef dartdocs should usually start with the phrase &quot;Signature for...&quot;.</p><h3 id="use-correct-grammar">Use correct grammar</h3><p>Avoid starting a sentence with a lowercase letter.</p><pre class="prettyprint source lang-dart"><code>
</code></pre><p>Similarly, end all sentences with a period.</p><h3 id="use-the-passive-voice%3B-recommend%2C-do-not-require%3B-never-say-things-are-simple">Use the passive voice; recommend, do not require; never say things are simple</h3><p>Never use &quot;you&quot; or &quot;we&quot;. Avoid the imperative voice. Avoid value judgements.</p><p>Rather than telling someone to do something, use &quot;Consider&quot;, as in <q>To obtain the foo, consider using [bar].</q>.</p><p>In general, you don’t know who is reading the documentation or why. Someone could have inherited a terrible codebase and be reading our documentation to find out how to fix it; by saying &quot;you should not do X&quot; or &quot;avoid Y&quot; or &quot;if you want Z&quot;, you will put the reader in a defensive state of mind when they find code that contradicts the documentation (after all, they inherited this codebase, who are we to say that they’re doing it wrong, it’s not their fault).</p><p>For similar reasons, never use the word &quot;simply&quot;, or say that the reader need &quot;just&quot; do something, or otherwise imply that the task is easy. By definition, if they are looking at the documentation, they are not finding it easy.</p><h3 id="provide-sample-code">Provide sample code</h3><p>Sample code helps developers learn your API quickly. Writing sample code also helps you think through how your API is going to be used by app developers.</p><p>Sample code should go in a documentation comment that typically begins with <code>/// {@tool dartpad}</code>, and ends with <code>/// {@end-tool}</code>, with the example source and corresponding tests placed in a file under <a href="https://github.com/flutter/flutter/blob/master/examples/api">the API examples directory</a>. This will then be checked by automated tools, and formatted for display on the API documentation web site <a href="https://api.flutter.dev">api.flutter.dev</a>. For details on how to write sample code, see <a href="https://github.com/flutter/flutter/blob/master/examples/api/README.md#authoring">the API example documentation</a>.</p><h4 id="provide-full-application-samples.">Provide full application samples.</h4><p>Our UX research has shown that developers prefer to see examples that are in the context of an entire app. So, whenever it makes sense, provide an example that can be presented as part of an entire application instead of just a snippet that uses the <code>{@tool snippet}</code> or ```dart ... ``` indicators.</p><p>An application sample can be created using the <code>{@tool dartpad}</code> ... <code>{@end-tool}</code> or <code>{@tool sample}</code> ... <code>{@end-tool}</code> dartdoc indicators. See <a href="https://github.com/flutter/flutter/blob/master/examples/api/README.md#authoring">here</a> for more details about writing these kinds of examples.</p><p>Dartpad examples (those using the dartdoc <code>{@tool dartpad}</code> indicator) will be presented on the <a href="https://api.flutter.dev">API documentation website</a> as an in-page executable and editable example. This allows developers to interact with the example right there on the page, and is the preferred form of example. Here is <a href="https://api.flutter.dev/flutter/widgets/AnimatedSwitcher-class.html#widgets.AnimatedSwitcher.1">one such example</a>.</p><p>For examples that don’t make sense in a web page (for example, code that interacts with a particular platform feature), application examples (using the dartdoc <code>{@tool sample}</code> indicator) are preferred, and will be presented on the API documentation website along with information about how to instantiate the example as an application that can be run.</p><p>Supported IDEs viewing the Flutter source code using the Flutter plugin also offer the option of creating a new project with either kind of example.</p><h3 id="provide-illustrations%2C-diagrams-or-screenshots">Provide illustrations, diagrams or screenshots</h3><p>For any widget that draws pixels on the screen, showing how it looks like in its API doc helps developers decide if the widget is useful and learn how to customize it. All illustrations should be easily reproducible, e.g. by running a Flutter app or a script.</p><p>Examples:</p><ul><li>A diagram for the AppBar widget</li></ul><p><img src="https://flutter.github.io/assets-for-api-docs/assets/material/app_bar.png" alt="app_bar"></p><ul><li>A screenshot for the Card widget</li></ul><p><img src="https://user-images.githubusercontent.com/348942/28338544-2c3681b8-6bbe-11e7-967d-fcd7c830bf53.png" alt="28338544-2c3681b8-6bbe-11e7-967d-fcd7c830bf53"></p><p>When creating diagrams, make sure to provide alternative text <a href="https://html.spec.whatwg.org/multipage/images.html#alt">as described in the HTML specification</a>.</p><h3 id="link-to-widget-of-the-week-videos">Link to Widget of the Week videos</h3><p>Link to a widget’s Flutter Widget of the Week video if it has one:</p><pre class="prettyprint source lang-dart"><code></code></pre><p>The first two arguments are the video’s width and height. These should be <code>560</code> and <code>315</code> respectively.</p><h3 id="clearly-mark-deprecated-apis">Clearly mark deprecated APIs</h3><p>We have conventions around deprecation. See the <a href="https://github.com/flutter/flutter/wiki/Tree-hygiene#deprecation">Tree Hygiene</a> page for more details.</p><h3 id="use-%2F%2F%2F-for-public-quality-private-documentation">Use <code>///</code> for public-quality private documentation</h3><p>In general, private code can and should also be documented. If that documentation is of good enough quality that we could include it verbatim when making the class public (i.e. it satisfies all the style guidelines above), then you can use <code>///</code> for those docs, even though they’re private.</p><p>Documentation of private APIs that is not of sufficient quality should only use <code>//</code>. That way, if we ever make the corresponding class public, those documentation comments will be flagged as missing, and we will know to examine them more carefully.</p><p>Feel free to be conservative in what you consider &quot;sufficient quality&quot;. It’s ok to use <code>//</code> even if you have multiple paragraphs of documentation; that’s a sign that we should carefully rereview the documentation when making the code public.</p><h3 id="dartdoc-templates-and-macros">Dartdoc templates and macros</h3><p>Dartdoc supports creating templates that can be reused in other parts of the code. They are defined like so:</p><pre class="prettyprint source lang-dart"><code></code></pre><p>and used via:</p><pre class="prettyprint source lang-dart"><code></code></pre><p>The <code>&lt;id&gt;</code> should be a unique identifier that is of the form <code>flutter.library.Class.member[.optionalDescription]</code>.</p><p>For example:</p><pre class="prettyprint source"><code>
</code></pre><p>The <code>optionalDescription</code> component of the identifier is only necessary if there is more than one template defined in one Dartdoc block. If a symbol is not part of a library, or not part of a class, then just omit those parts from the ID.</p><h3 id="dartdoc-specific-requirements">Dartdoc-specific requirements</h3><p>The first paragraph of any dartdoc section must be a short self-contained sentence that explains the purpose and meaning of the item being documented. Subsequent paragraphs then must elaborate. Avoid having the first paragraph have multiple sentences. (This is because the first paragraph gets extracted and used in tables of contents, etc, and so has to be able to stand alone and not take up a lot of room.)</p><p>When referencing a parameter, use backticks. However, when referencing a parameter that also corresponds to a property, use square brackets instead. (This contradicts the Dart style guide, which says to use square brackets for both. We do this because of <a href="https://github.com/dart-lang/dartdoc/issues/1486">dartdoc issue 1486</a>. Currently, there’s no way to unambiguously reference a parameter. We want to avoid cases where a parameter that happens to be named the same as a property despite having no relationship to that property gets linked to the property.)</p><pre class="prettyprint source lang-dart"><code>
    /// Creates a foobar, which allows a baz to quux the bar.
    ///
    /// The [bar] argument must not be null.
    ///
    /// The `baz` argument must be greater than zero.
    Foo({ this.bar, int baz }) : assert(bar != null), assert(baz > 0);
</code></pre><p>Avoid using terms like &quot;above&quot; or &quot;below&quot; to reference one dartdoc section from another. Dartdoc sections are often shown alone on a Web page, the full context of the class is not present.</p><h2 id="coding-patterns-and-catching-bugs-early">Coding patterns and catching bugs early</h2><h3 id="use-asserts-liberally-to-detect-contract-violations-and-verify-invariants">Use asserts liberally to detect contract violations and verify invariants</h3><p><code>assert()</code> allows us to be diligent about correctness without paying a performance penalty in release mode, because Dart only evaluates asserts in debug mode.</p><p>It should be used to verify contracts and invariants are being met as we expect. Asserts do not <em>enforce</em> contracts, since they do not run at all in release builds. They should be used in cases where it should be impossible for the condition to be false without there being a bug somewhere in the code.</p><p>The following example is from <code>box.dart</code>:</p><pre class="prettyprint source lang-dart"><code>abstract class RenderBox extends RenderObject {
  // ...

    double getDistanceToBaseline(TextBaseline baseline, {bool onlyReal: false}) {
      // simple asserts:
      assert(!needsLayout);
      assert(!_debugDoingBaseline);
      // more complicated asserts:
      assert(() {
        final RenderObject parent = this.parent;
        if (owner.debugDoingLayout)
          return (RenderObject.debugActiveLayout == parent) &&
              parent.debugDoingThisLayout;
        if (owner.debugDoingPaint)
          return ((RenderObject.debugActivePaint == parent) &&
                  parent.debugDoingThisPaint) ||
              ((RenderObject.debugActivePaint == this) && debugDoingThisPaint);
        assert(parent == this.parent);
        return false;
      });
      // ...
      return 0.0;
    }

    // ...
}
</code></pre><h3 id="prefer-specialized-functions%2C-methods-and-constructors">Prefer specialized functions, methods and constructors</h3><p>Use the most relevant constructor or method, when there are multiple options.</p><p>Example:</p><pre class="prettyprint source lang-dart"><code>const EdgeInsets.TRBL(0.0, 8.0, 0.0, 8.0);

const EdgeInsets.symmetric(horizontal: 8.0);
</code></pre><h3 id="minimize-the-visibility-scope-of-constants">Minimize the visibility scope of constants</h3><p>Prefer using a local const or a static const in a relevant class than using a global constant.</p><p>As a general rule, when you have a lot of constants, wrap them in a class. For examples of this, see <a href="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/material/colors.dart">lib/src/material/colors.dart</a>.</p><h3 id="avoid-using-if-chains-or-%3F%3A-or-%3D%3D-with-enum-values">Avoid using <code>if</code> chains or <code>?:</code> or <code>==</code> with enum values</h3><p>Use <code>switch</code> with no <code>default</code> case if you are examining an enum, since the analyzer will warn you if you missed any of the values when you use <code>switch</code>. The <code>default</code> case should be avoided so that the analyzer will complain if a value is missing. Unused values can be grouped together with a single <code>break</code> or <code>return</code> as appropriate.</p><p>Avoid using <code>if</code> chains, <code>? ... : ...</code>, or, in general, any expressions involving enums.</p><h3 id="avoid-using-var-and-dynamic">Avoid using <code>var</code> and <code>dynamic</code></h3><p>All variables and arguments are typed; avoid <code>dynamic</code> or <code>Object</code> in any case where you could figure out the actual type. Always specialize generic types where possible. Explicitly type all list and map literals. Give types to all parameters, even in closures and even if you don’t use the parameter.</p><p>This achieves two purposes: it verifies that the type that the compiler would infer matches the type you expect, and it makes the code self-documenting in the case where the type is not obvious (e.g. when calling anything other than a constructor).</p><p>Always avoid <code>var</code> and <code>dynamic</code>. If the type is unknown, prefer using <code>Object</code> (or <code>Object?</code>) and casting, as using <code>dynamic</code> disables all static checking.</p><h3 id="avoid-using-library-and-part-of.">Avoid using <code>library</code> and <code>part of</code>.</h3><p>Prefer that each library be self-contained. Only name a <code>library</code> if you are documenting it (see the documentation section).</p><p>We avoid using <code>part of</code> because that feature makes it very hard to reason about how private a private really is, and tends to encourage &quot;spaghetti&quot; code (where distant components refer to each other) rather than &quot;lasagna&quot; code (where each section of the code is cleanly layered and separable).</p><h3 id="avoid-using-extension.">Avoid using <code>extension</code>.</h3><p>Extension methods are confusing to document and discover. To an end developer, they appear no different than the built in API of the class, and discovering the documentation and implementation of an extension is more challenging than for class members.</p><p>Prefer instead adding methods directly to relevant classes. If that is not possible, create a method that clearly identifies what object(s) it works with and is part of.</p><p>(A rare exception can be made for extensions that provide temporary workarounds when deprecating features. In those cases, however, the extensions and all their members must be deprecated in the PR that adds them, and they must be removed in accordance with our deprecation policy.)</p><h3 id="avoid-using-futureor%3Ct%3E">Avoid using <code>FutureOr&lt;T&gt;</code></h3><p>The <code>FutureOr</code> type is a Dart-internal type used to explain certain aspects of the <code>Future</code> API. In public APIs, avoid the temptation to create APIs that are both synchronous and asynchronous by returning this type, as it usually only results in the API being more confusing and less type safe.</p><p>In certain extreme cases where the API absolutely needs to be asynchronous but a synchronous &quot;escape hatch&quot; is needed for performance, consider using <code>SynchronousFuture</code> (but be aware that this still suffers from many of the same risks of making the API only subtle and complicated). This is used, for example, when loading images in the Flutter framework.</p><p>You may use <code>FutureOr</code> to accept a callback that may or may not return a <code>Future</code>.</p><h3 id="avoid-using-expando">Avoid using <code>Expando</code></h3><p>Generally speaking, <code>Expando</code> objects are a sign of an architectural problem. Carefully consider whether your usage is actually necessary. When your classes have clear documented ownership rules, there is usually a better solution.</p><p>Expando objects tend to invite code that is hard to understand because one cannot simply follow references to find all the dependencies.</p><h3 id="avoid-using-%40visiblefortesting">Avoid using <code>@visibleForTesting</code></h3><p>The <a href="https://api.flutter.dev/flutter/meta/visibleForTesting-constant.html"><code>@visibleForTesting</code></a> annotation marks a public API so that developers that have not disabled the <code>invalid_use_of_visible_for_testing_member</code> analyzer error get a warning when they use this API outside of a <code>test</code> directory.</p><p>This means that the API has to be treated as being public (nothing prevents a developer from using the API even in non-test code), meaning it must be designed to be a public API, it must be documented, it must be tested, etc. At which point, there’s really no reason not to just make it a public API. If anything, the use of <code>@visibleForTesting</code> becomes merely a crutch to convince ourselves that it’s ok that we’re making something public that we should really not have made public.</p><p>So rather than rely on <code>@visibleForTesting</code>, consider designing your APIs so that they are directly testable using the public API, without exposing any sensitive internals.</p><p>(One exception is combining <code>@visibleForTesting</code> with <code>@protected</code>. The <code>@protected</code> annotation marks a member as one that is intended for subclasses, so it is already a public API and considered as such. The <code>@visibleForTesting</code> annotation in that case merely enables the member to be called directly in tests without having to create a fake subclass and without having to add <code>//ignore</code> pragmas.)</p><h3 id="never-check-if-a-port-is-available-before-using-it%2C-never-add-timeouts%2C-and-other-race-conditions.">Never check if a port is available before using it, never add timeouts, and other race conditions.</h3><p>If you look for an available port, then try to open it, it’s extremely likely that several times a week some other code will open that port between your check and when you open the port, and that will cause a failure.</p><blockquote><p>Instead, have the code that opens the port pick an available port and return it, rather than being given a (supposedly) available port.</p></blockquote><p>If you have a timeout, then it’s very likely that several times a week some other code will happen to run while your timeout is running, and your &quot;really conservative&quot; timeout will trigger even though it would have worked fine if the timeout was one second longer, and that will cause a failure.</p><blockquote><p>Instead, have the code that would time out just display a message saying that things are unexpectedly taking a long time, so that someone interactively using the tool can see that something is fishy, but an automated system won’t be affected.</p></blockquote><p>Race conditions like this are the primary cause of flaky tests, which waste everyone’s time.</p><p>Similarly, avoid delays or sleeps that are intended to coincide with how long something takes. You may think that waiting two seconds is fine because it normally takes 10ms, but several times a week your 10ms task will actually take 2045ms and your test will fail because waiting two seconds wasn’t long enough.</p><blockquote><p>Instead, wait for a triggering event.</p></blockquote><h3 id="avoid-mysterious-and-magical-numbers-that-lack-a-clear-derivation">Avoid mysterious and magical numbers that lack a clear derivation</h3><p>Numbers in tests and elsewhere should be clearly understandable. When the provenance of a number is not obvious, consider either leaving the expression or adding a clear comment (bonus points for leaving a diagram).</p><pre class="prettyprint source lang-dart"><code>expect(rect.left, 4.24264068712);

expect(rect.left, 3.0 * math.sqrt(2));
</code></pre><h3 id="have-good-hygiene-when-using-temporary-directories">Have good hygiene when using temporary directories</h3><p>Give the directory a unique name that starts with <code>flutter_</code> and ends with a period (followed by the autogenerated random string).</p><p>For consistency, name the <code>Directory</code> object that points to the temporary directory <code>tempDir</code>, and create it with <code>createTempSync</code> unless you need to do it asynchronously (e.g. to show progress while it’s being created).</p><p>Always clean up the directory when it is no longer needed. In tests, use the <code>tryToDelete</code> convenience function to delete the directory. (We use <code>tryToDelete</code> because on Windows it’s common to get &quot;access denied&quot; errors when deleting temporary directories. We have no idea why; if you can figure it out then that could simplify a lot of code!)</p><h3 id="perform-dirty-checks-in-setters">Perform dirty checks in setters</h3><p>Dirty checks are processes to determine whether a changed values have been synchronized with the rest of the app.</p><p>When defining mutable properties that mark a class dirty when set, use the following pattern:</p><pre class="prettyprint source lang-dart"><code>TheType get theProperty => _theProperty;
TheType _theProperty;
void set theProperty(TheType value) {
  assert(value != null);
  if (_theProperty == value)
    return;
  _theProperty = value;
  markNeedsWhatever(); // the method to mark the object dirty
}
</code></pre><p>The argument is called 'value' for ease of copy-and-paste reuse of this pattern. If for some reason you don’t want to use 'value', use 'newProperty' (where 'Property' is the property name).</p><p>Start the method with any asserts you need to validate the value.</p><p>Don’t do anything <em>else</em> in setters, other than marking the object as dirty and updating internal state. Getters and setters should not have significant side-effects. For example, setting a property whose value is a callback should not result in that callback being invoked. Setting a property whose value is an object of some sort should not result in any of that object’s methods being called.</p><h3 id="common-boilerplates-for-operator-%3D%3D-and-hashcode">Common boilerplates for <code>operator ==</code> and <code>hashCode</code></h3><p>We have many classes that override <code>operator ==</code> and <code>hashCode</code> (&quot;value classes&quot;). To keep the code consistent, we use the following style for these methods:</p><pre class="prettyprint source lang-dart"><code>  @override
  bool operator ==(Object other) {
    if (other.runtimeType != runtimeType) {
      return false;
    }
    return other is Foo 
        && other.bar == bar
        && other.baz == baz
        && other.quux == quux;
  }

    @override
    int get hashCode => Object.hash(bar, baz, quux);
</code></pre><p>For objects with a lot of properties, consider adding the following at the top of the <code>operator ==</code>:</p><pre class="prettyprint source lang-dart"><code>    if (identical(other, this)) {
      return true;
    }
</code></pre><p>(We don’t yet use this <em>exact</em> style everywhere, so feel free to update code you come across that isn’t yet using it.)</p><p>In general, consider carefully whether overriding <code>operator ==</code> is a good idea. It can be expensive, especially if the properties it compares are themselves comparable with a custom <code>operator ==</code>. If you do override equality, you should use <code>@immutable</code> on the class hierarchy in question.</p><h3 id="override-tostring">Override <code>toString</code></h3><p>Use <code>[Diagnosticable](https://api.flutter.dev/flutter/foundation/Diagnosticable-mixin.html)</code> (rather than directly overriding <code>toString</code>) on all but the most trivial classes. That allows us to inspect the object from <a href="https://pub.dartlang.org/packages/devtools">devtools</a> and IDEs.</p><p>For trivial classes, override <code>toString</code> as follows, to aid in debugging:</p><pre class="prettyprint source lang-dart"><code>  @override
  String toString() => '${objectRuntimeType(this, 'NameOfObject')}($bar, $baz, $quux)';
</code></pre><p>...but even then, consider using <code>Diagnosticable</code> instead. Avoid using <code>$runtimeType</code>, since it adds a non-trivial cost even in release and profile mode. The <code>objectRuntimeType</code> method handles this for you, falling back to a supplied constant string when asserts are disabled.</p><h3 id="be-explicit-about-dispose()-and-the-object-lifecycle">Be explicit about <code>dispose()</code> and the object lifecycle</h3><p>Even though Dart is garbage collected, having a defined object lifecycle and explicit ownership model (describing in the API documentation who is allowed to mutate the object, for instance) is important to avoid subtle bugs and confusing designs.</p><p>If your class has a clear &quot;end of life&quot;, for example, provide a <code>dispose()</code> method to clean up references such as listeners that would otherwise prevent some objects from getting garbage collected. For example, consider a widget that has a subscription on a global broadcast stream (that might have other listeners). That subscription will keep the widget from getting garbage collected until the stream itself goes away (which, for a global stream, might never happen).</p><p>In general, pretending that Dart does not have garbage collection is likely to lead to less confusing and buggy code, because it forces you to think about the implications of object ownership and lifecycles.</p><h3 id="test-apis-belong-in-the-test-frameworks">Test APIs belong in the test frameworks</h3><p>Mechanisms that exist for test purposes do not belong in the core libraries, they belong in test harnesses. This keeps the cost of the main library down in production and avoids the risk that people might abuse test APIs.</p><h3 id="immutable-classes-should-not-have-hidden-state">Immutable classes should not have hidden state</h3><p>Immutable classes (those with <code>const</code> constructors) should not have hidden state. For example, they should not use private statics or Expandos. If they are stateful, then they should not be <code>const</code>.</p><h3 id="avoid-sync*%2Fasync*">Avoid <code>sync*</code>/<code>async*</code></h3><p>Using generator functions (<code>sync*</code>/<code>async*</code>) can be a powerful improvement when callers will actually lazily evaluate the iterable and each iteration is expensive <em>or</em> there are a very large number of iterations.</p><p>It should not be used in place of building and returning a <code>List</code>, particularly for trivial methods that only yield a small number of members or when callers will evaluate the whole collection anyway. It should also be avoided in very large functions.</p><p>It incurs runtime overhead in maintaining and using an iterator, and space overhead for the compiler to actually desugar the generator into something that uses an iterator class.</p><h2 id="writing-tests">Writing tests</h2><h3 id="make-each-test-entirely-self-contained">Make each test entirely self-contained</h3><p>Embrace code duplication in tests. It makes it easier to make new tests by copying and pasting them and tweaking a few things.</p><p>Avoid using <code>setUp</code>, <code>tearDown</code>, and similar features, as well as test-global variables or other state shared between tests. They make writing tests easier but make maintaining them, debugging them, and refactoring code much harder. (These are commonly used in Flutter’s codebase today, but that is almost always a mistake. When you are editing a file that uses those features, aim to reduce the number of tests using them while you’re there.)</p><p>Specifically, we are trying to avoid shared state, which could persist across tests, and non-local side-effects, which would prevent being able to move a test to another file without breaking the test. (It’s fine to factor out code into functions that are called by tests, so long as the functions don’t have side-effects that might change how other tests run.)</p><h3 id="prefer-more-test-files%2C-avoid-long-test-files">Prefer more test files, avoid long test files</h3><p>Avoid adding tests to files that already have more than one or two hundred lines of code. It’s easier to understand a test file when it has only a few related tests, rather than when it has an entire test suite. (It also makes developing the tests faster because you can run the test file faster.)</p><h3 id="avoid-using-pumpandsettle">Avoid using <code>pumpAndSettle</code></h3><p>As per the API docs for <a href="https://main-api.flutter.dev/flutter/flutter_test/WidgetController/pumpAndSettle.html">pumpAndSettle</a>, prefer using explicit <a href="https://main-api.flutter.dev/flutter/flutter_test/WidgetController/pump.html"><code>pump</code></a> calls rather than <code>pumpAndSettle</code>.</p><p>Using <code>pumpAndSettle</code>, especially without checking its return value, makes it very easy for bugs to sneak in where we trigger animations across multiple frames instead of immediately. It is almost always the case that a call to <code>pumpAndSettle</code> is more strictly correctly written as two <code>pump</code> calls, one to trigger the animations and one (with a duration) to jump to the point after the animations.</p><h2 id="naming">Naming</h2><h3 id="begin-global-constant-names-with-prefix-%22k%22">Begin global constant names with prefix &quot;k&quot;</h3><p>Examples:</p><pre class="prettyprint source lang-dart"><code>const double kParagraphSpacing = 1.5;
const String kSaveButtonTitle = 'Save';
</code></pre><p>However, where possible avoid global constants. Rather than <code>kDefaultButtonColor</code>, consider <code>Button.defaultColor</code>. If necessary, consider creating a class with a private constructor to hold relevant constants.</p><h3 id="avoid-abbreviations">Avoid abbreviations</h3><p>Unless the abbreviation is more recognizable than the expansion (e.g. XML, HTTP, JSON), expand abbrevations when selecting a name for an identifier. In general, avoid one-character names unless one character is idiomatic (for example, prefer <code>index</code> over <code>i</code>, but prefer <code>x</code> over <code>horizontalPosition</code>).</p><h3 id="avoid-anonymous-parameter-names">Avoid anonymous parameter names</h3><p>Provide full type information and names even for parameters that are otherwise unused. This makes it easier for people reading the code to tell what is actually going on (e.g. what is being ignored). For example:</p><pre class="prettyprint source lang-dart"><code>  onTapDown: (TapDownDetails details) { print('hello!'); }, // GOOD
  onTapUp: (_) { print('good bye'); }, // BAD
</code></pre><h3 id="naming-rules-for-typedefs-and-function-variables">Naming rules for typedefs and function variables</h3><p>When naming callbacks, use <code>FooCallback</code> for the typedef, <code>onFoo</code> for the callback argument or property, and <code>handleFoo</code> for the method that is called. If <code>Foo</code> is a verb, prefer the present tense to the past tense (e.g. <code>onTap</code> instead of <code>onTapped</code>).</p><p>If you have a callback with arguments but you want to ignore the arguments, give the type and names of the arguments anyway. That way, if someone copies and pastes your code, they will not have to look up what the arguments are.</p><p>Never call a method <code>onFoo</code>. If a property is called <code>onFoo</code> it must be a function type. (For all values of &quot;Foo&quot;.)</p><p>Prefer using <code>typedef</code>s to declare callbacks. Typedefs benefit from having documentation on the type itself and make it easier to read and find common callsites for the signature.</p><h3 id="spell-words-in-identifiers-and-comments-correctly">Spell words in identifiers and comments correctly</h3><p>Our primary source of truth for spelling is the <a href="https://material.google.com/">Material Design Specification</a>. Our secondary source of truth is dictionaries.</p><p>Avoid &quot;cute&quot; spellings. For example, 'colors', not 'colorz'.</p><p>Prefer US English spellings. For example, 'colorize', not 'colourise', and 'canceled', not 'cancelled'.</p><p>Prefer compound words over &quot;cute&quot; spellings to avoid conflicts with reserved words. For example, 'classIdentifier', not 'klass'.</p><h3 id="capitalize-identifiers-consistent-with-their-spelling">Capitalize identifiers consistent with their spelling</h3><p>In general, we use <a href="https://dart.dev/guides/language/effective-dart/style#identifiers">Dart’s recommendations</a>'s for naming identifiers. Please consider the following additional guidelines:</p><p>If a word is correctly spelled (according to our sources of truth as described in the previous section) as a single word, then it should not have any inner capitalization or spaces.</p><p>For examples, prefer <code>toolbar</code>, <code>scrollbar</code>, but <code>appBar</code> ('app bar' in documentation), <code>tabBar</code> ('tab bar' in documentation).</p><p>Similarly, prefer <code>offstage</code> rather than <code>offStage</code>.</p><p>Avoid using class names with <code>iOS</code> when possible. The capitalization of <code>iOS</code> is supposed to be exactly that, but that doesn’t work well with camelCase and even less with UpperCamelCase; use alternatives like &quot;Cupertino&quot; or &quot;UIKit&quot; instead when possible. If you really really must use &quot;iOS&quot; in an identifier, capitalize it to <code>IOS</code>. Whether or not <a href="https://dart.dev/guides/language/effective-dart/style#do-capitalize-acronyms-and-abbreviations-longer-than-two-letters-like-words">the two-letter exception</a> applies to &quot;iOS&quot; is debatable, but <code>IOS</code> is consistent with Dart APIs, and the alternatives (<code>IOs</code>, <code>Ios</code>) are even more jarring. (Previous versions of this guide incorrectly indicated that <code>Ios</code> was the correct capitalization when necessary; this form should not be used in new code.)</p><h3 id="avoid-double-negatives-in-apis">Avoid double negatives in APIs</h3><p>Name your boolean variables in positive ways, such as &quot;enabled&quot; or &quot;visible&quot;, even if the default value is true.</p><p>This is because, when you have a property or argument named &quot;disabled&quot; or &quot;hidden&quot;, it leads to code such as <code>input.disabled = false</code> or <code>widget.hidden = false</code> when you’re trying to enable or show the widget, which is very confusing.</p><h3 id="prefer-naming-the-argument-to-a-setter-value">Prefer naming the argument to a setter <code>value</code></h3><p>Unless this would cause other problems, use <code>value</code> for the name of a setter’s argument. This makes it easier to copy/paste the setter later.</p><h3 id="qualify-variables-and-methods-used-only-for-debugging">Qualify variables and methods used only for debugging</h3><p>If you have variables or methods (or even classes!) that are only used in debug mode, prefix their names with <code>debug</code> or <code>_debug</code> (or, for classes, <code>_Debug</code>).</p><p>Do not use debugging variables or methods (or classes) in production code.</p><h3 id="avoid-naming-undocumented-libraries">Avoid naming undocumented libraries</h3><p>In other words, do not use the <code>library</code> keyword, unless it is a documented top-level library intended to be imported by users.</p><h3 id="avoid-%22new%2Fold%22-modifiers-in-code">Avoid &quot;new/old&quot; modifiers in code</h3><p>The definition of &quot;New&quot; changes as code grows and time passes. If the code needed a replacement version the odds of needing another replacement in the future is higher. Instead find a name that represents the idea being being used or replaced.</p><h2 id="comments">Comments</h2><h3 id="avoid-checking-in-comments-that-ask-questions">Avoid checking in comments that ask questions</h3><p>Find the answers to the questions, or describe the confusion, including references to where you found answers.</p><p>If commenting on a workaround due to a bug, also leave a link to the issue and a TODO to clean it up when the bug is fixed.</p><p>Example:</p><pre class="prettyprint source lang-dart"><code>
</code></pre><p>TODOs should include the string TODO in all caps, followed by the GitHub username of the person with the best <em>context</em> about the problem referenced by the TODO in parenthesis. A TODO is not a commitment that the person referenced will fix the problem, it is intended to be the person with enough context to explain the problem. Thus, when you create a TODO, it is almost always your username that is given.</p><p>Including an issue link in a TODO description is required.</p><p><em>(See also <a href="https://github.com/flutter/flutter/issues/37519">#37519</a>, which tracks a proposal to change the syntax of TODOs to not include usernames.)</em></p><h3 id="comment-all-%2F%2F-ignores">Comment all <code>// ignores</code></h3><p>Sometimes, it is necessary to write code that the analyzer is unhappy with.</p><p>If you find yourself in this situation, consider how you got there. Is the analyzer actually correct but you don’t want to admit it? Think about how you could refactor your code so that the analyzer is happy. If such a refactor would make the code better, do it. (It might be a lot of work... embrace the yak shave.)</p><p>If you are really really sure that you have no choice but to silence the analyzer, use <code>// ignore:</code>. The ignore directive should be on the same line as the analyzer warning.</p><p>If the ignore is temporary (e.g. a workaround for a bug in the compiler or analyzer, or a workaround for some known problem in Flutter that you cannot fix), then add a link to the relevant bug, as follows:</p><pre class="prettyprint source lang-dart"><code>  foo(); // ignore: lint_code, https://link.to.bug/goes/here
</code></pre><p>If the ignore directive is permanent, e.g. because one of our lints has some unavoidable false positives and in this case violating the lint is definitely better than all other options, then add a comment explaining why:</p><pre class="prettyprint source lang-dart"><code>  foo(); // ignore: lint_code, sadly there is no choice but to do
  // this because we need to twiddle the quux and the bar is zorgle.
</code></pre><h3 id="comment-all-test-skips">Comment all test skips</h3><p>On very rare occasions it may be necessary to skip a test. To do that, use the <code>skip</code> argument. Any time you use the <code>skip</code> argument, file an issue describing why it is skipped and include a link to that issue in the code.</p><h3 id="comment-empty-closures-to-setstate">Comment empty closures to <code>setState</code></h3><p>Generally the closure passed to <code>setState</code> should include all the code that changes the state. Sometimes this is not possible because the state changed elsewhere and the <code>setState</code> is called in response. In those cases, include a comment in the <code>setState</code> closure that explains what the state is that changed.</p><pre class="prettyprint source lang-dart"><code>  setState(() { /* The animation ticked. We use the animation’s value in the build method. */ });
</code></pre><h2 id="formatting">Formatting</h2><p>These guidelines have no technical effect, but they are still important purely for consistency and readability reasons.</p><p>We do not yet use <code>dartfmt</code> (except in flutter/packages). Flutter code tends to use patterns that the standard Dart formatter does not handle well. We are <a href="https://github.com/flutter/flutter/issues/2025">working with Dart team</a> to make <code>dartfmt</code> aware of these patterns.</p><h3 id="in-defense-of-the-extra-work-that-hand-formatting-entails">In defense of the extra work that hand-formatting entails</h3><p>Flutter code might eventually be read by hundreds of thousands of people each day. Code that is easier to read and understand saves these people time. Saving each person even a second each day translates into hours or even <em>days</em> of saved time each day. The extra time spent by people contributing to Flutter directly translates into real savings for our developers, which translates to real benefits to our end users as our developers learn the framework faster.</p><h3 id="constructors-come-first-in-a-class">Constructors come first in a class</h3><p>The default (unnamed) constructor should come first, then the named constructors. They should come before anything else (including, e.g., constants or static methods).</p><p>This helps readers determine whether the class has a default implied constructor or not at a glance. If it was possible for a constructor to be anywhere in the class, then the reader would have to examine every line of the class to determine whether or not there was an implicit constructor or not.</p><h3 id="order-other-class-members-in-a-way-that-makes-sense">Order other class members in a way that makes sense</h3><p>The methods, properties, and other members of a class should be in an order that will help readers understand how the class works.</p><p>If there’s a clear lifecycle, then the order in which methods get invoked would be useful, for example an <code>initState</code> method coming before <code>dispose</code>. This helps readers because the code is in chronological order, so they can see variables get initialized before they are used, for instance. Fields should come before the methods that manipulate them, if they are specific to a particular group of methods.</p><blockquote><p>For example, RenderObject groups all the layout fields and layout methods together, then all the paint fields and paint methods, because layout happens before paint.</p></blockquote><p>If no particular order is obvious, then the following order is suggested, with blank lines between each one:</p><ol><li>Constructors, with the default constructor first.</li><li>Constants of the same type as the class.</li><li>Static methods that return the same type as the class.</li><li>Final fields that are set from the constructor.</li><li>Other static methods.</li><li>Static properties and constants.</li><li>Members for mutable properties, without new lines separating the members of a property, each property in the order:<ul><li>getter</li><li>private field</li><li>setter</li></ul></li><li>Read-only properties (other than <code>hashCode</code>).</li><li>Operators (other than <code>==</code>).</li><li>Methods (other than <code>toString</code> and <code>build</code>).</li><li>The <code>build</code> method, for <code>Widget</code> and <code>State</code> classes.</li><li><code>operator ==</code>, <code>hashCode</code>, <code>toString</code>, and diagnostics-related methods, in that order.</li></ol><p>Be consistent in the order of members. If a constructor lists multiple fields, then those fields should be declared in the same order, and any code that operates on all of them should operate on them in the same order (unless the order matters).</p><h3 id="constructor-syntax">Constructor syntax</h3><p>If you call <code>super()</code> in your initializer list, put a space between the constructor arguments' closing parenthesis and the colon. If there’s other things in the initializer list, align the <code>super()</code> call with the other arguments. Don’t call <code>super</code> if you have no arguments to pass up to the superclass.</p><pre class="prettyprint source lang-dart"><code>abstract class Foo extends StatelessWidget {
  Foo(this.bar, { Key key, this.child }) : super(key: key);
  final int bar;
  final Widget child;
  // ...
}

abstract class Foo extends StatelessWidget {
  Foo(
    this.bar, {
    Key key,
    Widget childWidget,
  }) : child = childWidget,
       super(
         key: key,
       );
  final int bar;
  final Widget child;
  // ...
}
</code></pre><h3 id="prefer-a-maximum-line-length-of-80-characters">Prefer a maximum line length of 80 characters</h3><p>Aim for a maximum line length of roughly 80 characters, but prefer going over if breaking the line would make it less readable, or if it would make the line less consistent with other nearby lines. Prefer avoiding line breaks after assignment operators.</p><pre class="prettyprint source lang-dart"><code>final int a = 1;
final int b = 2;
final int c =
    a.very.very.very.very.very.long.expression.that.returns.three.eventually().but.is.very.long();
final int d = 4;
final int e = 5;

final int a = 1;
final int b = 2;
final int c = a.very.very.very.very.very.long.expression.that.returns.three.eventually().but.is.very.long();
final int d = 4;
final int e = 5;
</code></pre><pre class="prettyprint source lang-dart"><code>final List&lt;FooBarBaz> _members =
  &lt;FooBarBaz>[const Quux(), const Qaax(), const Qeex()];

final List&lt;FooBarBaz> _members = &lt;FooBarBaz>[const Quux(), const Qaax(), const Qeex()];

final List&lt;FooBarBaz> _members = &lt;FooBarBaz>[
  const Quux(),
  const Qaax(),
  const Qeex(),
];
</code></pre><h3 id="indent-multi-line-argument-and-parameter-lists-by-2-characters">Indent multi-line argument and parameter lists by 2 characters</h3><p>When breaking an argument list into multiple lines, indent the arguments two characters from the previous line.</p><p>Example:</p><pre class="prettyprint source lang-dart"><code>Foo f = Foo(
  bar: 1.0,
  quux: 2.0,
);
</code></pre><p>When breaking a parameter list into multiple lines, do the same.</p><h3 id="if-you-have-a-newline-after-some-opening-punctuation%2C-match-it-on-the-closing-punctuation.">If you have a newline after some opening punctuation, match it on the closing punctuation.</h3><p>And vice versa.</p><p>Example:</p><pre class="prettyprint source lang-dart"><code>  foo(
    bar, baz);
  foo(
    bar,
    baz);
  foo(bar,
    baz
  );

    foo(bar, baz);
    foo(
      bar,
      baz,
    );
    foo(bar,
      baz);
</code></pre><h3 id="use-a-trailing-comma-for-arguments%2C-parameters%2C-and-list-items%2C-but-only-if-they-each-have-their-own-line.">Use a trailing comma for arguments, parameters, and list items, but only if they each have their own line.</h3><p>Example:</p><pre class="prettyprint source lang-dart"><code>List&lt;int> myList = [
  1,
  2,
];
myList = &lt;int>[3, 4];

foo1(
  bar,
  baz,
);
foo2(bar, baz);
</code></pre><p>Whether to put things all on one line or whether to have one line per item is an aesthetic choice. We prefer whatever ends up being most readable. Typically this means that when everything would fit on one line, put it all on one line, otherwise, split it one item to a line.</p><p>However, there are exceptions. For example, if there are six back-to-back lists and all but one of them need multiple lines, then one would not want to have the single case that does fit on one line use a different style than the others.</p><pre class="prettyprint source lang-dart"><code>  // BAD (because the second list is unnecessarily and confusingly different than the others):
  List&lt;FooBarBaz> myLongList1 = &lt;FooBarBaz>[
    FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
    FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
    FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
  ];
  List&lt;Quux> myLongList2 = &lt;Quux>[ Quux(1), Quux(2) ];
  List&lt;FooBarBaz> myLongList3 = &lt;FooBarBaz>[
    FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
    FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
    FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
  ];

    // GOOD (code is easy to scan):
    List&lt;FooBarBaz> myLongList1 = &lt;FooBarBaz>[
      FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
      FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
      FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
    ];
    List&lt;Quux> myLongList2 = &lt;Quux>[
      Quux(1),
      Quux(2),
    ];
    List&lt;FooBarBaz> myLongList3 = &lt;FooBarBaz>[
      FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
      FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
      FooBarBaz(one: firstArgument, two: secondArgument, three: thirdArgument),
    ];
</code></pre><h3 id="prefer-single-quotes-for-strings">Prefer single quotes for strings</h3><p>Use double quotes for nested strings or (optionally) for strings that contain single quotes. For all other strings, use single quotes.</p><p>Example:</p><pre class="prettyprint source lang-dart"><code>print('Hello ${name.split(&quot; &quot;)[0]}');
</code></pre><h3 id="consider-using-%3D%3E-for-short-functions-and-methods">Consider using <code>=&gt;</code> for short functions and methods</h3><p>But only use <code>=&gt;</code> when everything, including the function declaration, fits on a single line.</p><p>Example:</p><pre class="prettyprint source lang-dart"><code>String capitalize(String s) =>
  '${s[0].toUpperCase()}${s.substring(1)}';

String capitalize(String s) => '${s[0].toUpperCase()}${s.substring(1)}';

String capitalize(String s) {
  return '${s[0].toUpperCase()}${s.substring(1)}';
}
</code></pre><h3 id="use-%3D%3E-for-inline-callbacks-that-just-return-literals-or-switch-expressions">Use <code>=&gt;</code> for inline callbacks that just return literals or switch expressions</h3><p>If your code is passing an inline closure that merely returns a list or map literal, or a switch expression, or is merely calling another function, then if the argument is on its own line, then rather than using braces and a return<code>statement, you can instead use the</code>=&gt;<code>form. When doing this, the closing</code>]<code>,</code>}<code>, or</code>)<code>bracket will line up with the argument name, for named arguments, or the</code>(` of the argument list, for positional arguments.</p><p>For example:</p><pre class="prettyprint source lang-dart"><code>    // GOOD, but slightly more verbose than necessary since it doesn’t use =>
    @override
    Widget build(BuildContext context) {
      return PopupMenuButton&lt;String>(
        onSelected: (String value) { print('Selected: $value'); },
        itemBuilder: (BuildContext context) {
          return &lt;PopupMenuItem&lt;String>>[
            PopupMenuItem&lt;String>(
              value: 'Friends',
              child: MenuItemWithIcon(Icons.people, 'Friends', '5 new')
            ),
            PopupMenuItem&lt;String>(
              value: 'Events',
              child: MenuItemWithIcon(Icons.event, 'Events', '12 upcoming')
            ),
          ];
        }
      );
    }

    // GOOD, does use =>, slightly briefer
    @override
    Widget build(BuildContext context) {
      return PopupMenuButton&lt;String>(
        onSelected: (String value) { print('Selected: $value'); },
        itemBuilder: (BuildContext context) => &lt;PopupMenuItem&lt;String>>[
          PopupMenuItem&lt;String>(
            value: 'Friends',
            child: MenuItemWithIcon(Icons.people, 'Friends', '5 new')
          ),
          PopupMenuItem&lt;String>(
            value: 'Events',
            child: MenuItemWithIcon(Icons.event, 'Events', '12 upcoming')
          ),
        ]
      );
    }
</code></pre><p>The important part is that the closing punctuation lines up with the start of the line that has the opening punctuation, so that you can easily determine what’s going on by just scanning the indentation on the left edge.</p><h3 id="prefer-single-line-for-short-collection-if-and-collection-for">Prefer single line for short collection-if and collection-for</h3><p>If the code fits in a single line don’t split it.</p><p>For example:</p><pre class="prettyprint source lang-dart"><code>final List&lt;String> args = &lt;String>[
  'test',
  if (useFlutterTestFormatter) '-rjson'
  else '-rcompact',
  '-j1',
  if (!hasColor)
    '--no-color',
  for (final String opt in others)
    opt,
];

final List&lt;String> args = &lt;String>[
  'test',
  if (useFlutterTestFormatter) '-rjson' else '-rcompact',
  '-j1',
  if (!hasColor) '--no-color',
  for (final String opt in others) opt,
];
</code></pre><p>Otherwise indent with 2 spaces</p><pre class="prettyprint source lang-dart"><code>final List&lt;String> args = &lt;String>[
  'test',
  if (useFlutterTestFormatter)
    '-rjson.very.very.very.very.very.very.very.very.long'
  else
    '-rcompact.very.very.very.very.very.very.very.very.long',
  '-j1',
  if (!hasColor)
    '--no-color.very.very.very.very.very.very.very.very.long',
  for (final String opt in others)
    methodVeryVeryVeryVeryVeryVeryVeryVeryVeryLong(opt),
];
</code></pre><h3 id="put-spread-inside-collection-if-or-collection-for-on-the-same-line">Put spread inside collection-if or collection-for on the same line</h3><p>Spreads inside collection-if or collection-for are used to insert several elements. It’s easier to read to have spread on the line of <code>if</code>, <code>else</code>, or <code>for</code>.</p><pre class="prettyprint source lang-dart"><code>final List&lt;String> args = &lt;String>[
  'test',
  if (condA) 
    ...&lt;String>[
      'b',
      'c',
    ]
  else
    '-rcompact',
  for (final String opt in others)
    ...&lt;String>[
      m1(opt),
      m2(opt),
    ],
];

final List&lt;String> args = &lt;String>[
  'test',
  if (condA) ...&lt;String>[
    'b',
    'c',
  ] else
    '-rcompact',
  for (final String opt in others) ...&lt;String>[
    m1(opt),
    m2(opt),
  ],
];
</code></pre><h3 id="use-braces-for-long-functions-and-methods">Use braces for long functions and methods</h3><p>Use a block (with braces) when a body would wrap onto more than one line (as opposed to using <code>=&gt;</code>; the cases where you can use <code>=&gt;</code> are discussed in the previous two guidelines).</p><h3 id="separate-the-'if'-expression-from-its-statement">Separate the 'if' expression from its statement</h3><p>(This is enforced by the <code>always_put_control_body_on_new_line</code> and <code>curly_braces_in_flow_control_structures</code> lints.)</p><p>Don’t put the statement part of an 'if' statement on the same line as the expression, even if it is short. (Doing so makes it unobvious that there is relevant code there. This is especially important for early returns.)</p><p>Example:</p><pre class="prettyprint source lang-dart"><code>if (notReady) return;

if (notReady) {
  return;
}
</code></pre><p>If the body is more than one line, or if there is an <code>else</code> clause, wrap the body in braces:</p><pre class="prettyprint source lang-dart"><code>if (foo)
  bar(
    'baz',
  );

if (foo)
  bar();
else
  baz();

if (foo) {
  bar(
    'baz',
  );
}

if (foo) {
  bar();
} else {
  baz();
}
</code></pre><p>We require bodies to make it very clear where the bodies belong.</p><h3 id="align-expressions">Align expressions</h3><p>Where possible, subexpressions on different lines should be aligned, to make the structure of the expression easier. When doing this with a <code>return</code> statement chaining <code>||</code> or <code>&amp;&amp;</code> operators, consider putting the operators on the left hand side instead of the right hand side.</p><pre class="prettyprint source lang-dart"><code>if (foo.foo.foo + bar.bar.bar * baz - foo.foo.foo * 2\
    bar.bar.bar * 2 * baz > foo.foo.foo) {
  // ...
}

if (foo.foo.foo     + bar.bar.bar     * baz -
    foo.foo.foo * 2 + bar.bar.bar * 2 * baz   > foo.foo.foo) {
  // ...
}
if (bar.bar.bar * 3 * baz > foo.foo.foo * 2) {
  // ...
}
</code></pre><pre class="prettyprint source lang-dart"><code>return foo.x == x &&
    foo.y == y &&
    foo.z == z;

return foo.x == x &&
       foo.y == y &&
       foo.z == z;

return foo.x == x
    && foo.y == y
    && foo.z == z;
</code></pre><h3 id="prefer-%3D-over-%2B">Prefer <code>=</code> over <code>+</code></h3><p>We generally slightly prefer <code>=</code> over <code>+</code>.</p><p>In some languages/compilers postfix <code>++</code> is an antipattern because of performance reasons, and so it’s easier to just avoid it in general.</p><p>Because of the former, some people will use the prefix <code>++</code>, but this leads to statements that lead with punctuation, which is aesthetically displeasing.</p><p>In general, mutating variables as part of larger expressions leads to confusion about the order of operations, and entwines the increment with another calculation.</p><p>Using <code>++</code> does not make it obvious that the underlying variable is actually being mutated, whereas <code>+=</code> more clearly does (it’s an assignment with an <code>=</code> sign).</p><p>Finally, <code>+=</code> is more convenient when changing the increment to a number other than 1.</p><h3 id="use-double-literals-for-double-constants">Use double literals for double constants</h3><p>To make it clearer when something is a double or an integer, even if the number is a round number, include a decimal point in double literals. For example, if a function <code>foo</code> takes a double, write <code>foo(1.0)</code> rather than <code>foo(1)</code> because the latter makes it look like the function takes an integer.</p><h2 id="conventions">Conventions</h2><h3 id="expectations-around-potential-crashes-in-the-engine">Expectations around potential crashes in the engine</h3><p>The engine should never crash in an uncontrolled fashion.</p><p>In unopt mode, the engine C++ code should have asserts that check for contract violations.</p><p>In opt debug mode, the <code>dart:ui</code> code should have asserts that check for contract violations. These asserts should have messages that are detailed and useful, if they are not self-explanatory.</p><p>In opt release mode, the exact behavior can be arbitrary so long as it is defined and non-vulnerable for every input. For example, a contract violation could be checked in Dart, with an exception thrown for invalid data; but equally valid would be for the C++ code to return early when faced with invalid data. The idea is to optimize for speed in the case where the data is valid.</p><p>For practical purposes we don’t currently check for out-of-memory errors. Ideally we would.</p><h3 id="features-we-expect-every-widget-to-implement">Features we expect every widget to implement</h3><p>Now that the Flutter framework is mature, we expect every new widget to implement all of the following:</p><ul><li>full accessibility, so that on both Android and iOS the widget works with the native accessibility tools.</li><li>full localization with default translations for all our default languages.</li><li>full support for both right-to-left and left-to-right layouts, driven by the ambient Directionality.</li><li>full support for text scaling up to at least 3.0x.</li><li>documentation for every member; see the section above for writing prompts to write documentation.</li><li>good performance even when used with large amounts of user data.</li><li>a complete lifecycle contract with no resource leaks (documented, if it differs from usual widgets).</li><li>tests for all the above as well as all the unique functionality of the widget itself.</li></ul><p>It’s the job of the programmer to provide these before submitting a PR.</p><p>It’s the job of the reviewer to check that all these are present when reviewing a PR.</p><h3 id="use-of-streams-in-flutter-framework-code">Use of streams in Flutter framework code</h3><p>In general we avoid the use of <code>Stream</code> classes in Flutter framework code (and <code>dart:ui</code>). Streams in general are fine and we encourage people to use them. However, they have some disadvantages and we prefer to keep them out of the framework for this reason. For example:</p><ul><li>Streams have a heavy API. For example, they can be synchronous or asynchronous, broadcast or single-client, and they can be paused and resumed. It is non-trivial to determine the right semantics for a particular stream when it will be used in all the ways framework code could be used, and it is non-trivial to fully implement the semantics correctly.</li><li>Streams don’t have a &quot;current value&quot; accessor, which makes them difficult to use in <code>build</code> methods.</li><li>The APIs for manipulating streams are non-trivial (e.g. transformers).</li></ul><p>We generally prefer <code>Listenable</code> subclasses (e.g. <code>ValueNotifier</code> or <code>ChangeNotifier</code>).</p><p>In the specific case of exposing a value from <code>dart:ui</code> via a callback, we expect the bindings in the framework to register a single listener and then provide a mechanism to fan the notification to multiple listeners. Sometimes this is a rather involved process (e.g. the <code>SchedulerBinding</code> exists almost entirely for the purpose of doing this for <code>onBeginFrame</code>/<code>onDrawFrame</code>, and the <code>GesturesBinding</code> exists exclusively for the purpose of doing this for pointer events). Sometimes it’s simpler (e.g. propagating changes to life cycle events).</p><h2 id="packages">Packages</h2><h3 id="structure">Structure</h3><p>As per normal Dart conventions, a package should have a single import that reexports all of its API.</p><blockquote><p>For example, <a href="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/rendering.dart">rendering.dart</a> exports all of lib/src/rendering/*.dart</p></blockquote><p>If a package uses, as part of its exposed API, types that it imports from a lower layer, it should reexport those types.</p><blockquote><p>For example, <a href="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/material.dart">material.dart</a> reexports everything from <a href="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/widgets.dart">widgets.dart</a>. Similarly, the latter <a href="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/widgets/basic.dart">reexports</a> many types from <a href="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/rendering.dart">rendering.dart</a>, such as <code>BoxConstraints</code>, that it uses in its API. On the other hand, it does not reexport, say, <code>RenderProxyBox</code>, since that is not part of the widgets API.</p></blockquote><p>Flutter packages should not have &quot;private&quot; APIs other than those that are prefixed with underscores. Every file in a Flutter package should be exported. (&quot;Private&quot; files can still be imported so they are still actually public APIs; by not exporting them explicitly we are tricking ourselves into thinking of them as private APIs which may lead to poor design.)</p><p>When developing new features in Flutter packages, one should follow the philosophy:</p><blockquote><p>Only expose the APIs that are necessities to the features.</p></blockquote><p>Since the private classes in dart language are file-bound, this may often result in large file sizes. In Flutter, this is considered to be more preferable than creating multiple smaller files but exposing intermediate classes that are not needed to use the features.</p><h3 id="import-conventions">Import conventions</h3><p>Under lib/src, for in-folder import use relative import. For cross-folder import, import the entire package with absolute import.</p><p>When importing the <code>rendering.dart</code> library into higher level libraries, if you are creating new <code>RenderObject</code> subclasses, import the entire library. If you are only referencing specific <code>RenderObject</code> subclasses, then import the <code>rendering.dart</code> library with a <code>show</code> keyword explicitly listing the types you are importing. This latter approach is generally good for documenting why exactly you are importing particularly libraries and can be used more generally when importing large libraries for very narrow purposes.</p><p>By convention, <code>dart:ui</code> is imported using <code>import 'dart:ui' show ...;</code> for common APIs (this isn’t usually necessary because a lower level will have done it for you), and as <code>import 'dart:ui' as ui show ...;</code> for low-level APIs, in both cases listing all the identifiers being imported. See <a href="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/painting/basic_types.dart">basic_types.dart</a> in the <code>painting</code> package for details of which identifiers we import which way. Other packages are usually imported undecorated unless they have a convention of their own (e.g. <code>path</code> is imported <code>as path</code>).</p><p>The <code>dart:math</code> library is always imported <code>as math</code>.</p><h3 id="deciding-where-to-put-code">Deciding where to put code</h3><p>As a general rule, if a feature is entirely self-contained (not requiring low-level integration into the Flutter framework) and is not something with universal appeal, we would encourage that that feature be provided as a package.</p><p>We try to be very conservative with what we put in the core framework, because there’s a high cost to having anything there. We have to commit to supporting it for years to come, we have to document it, test it, create samples, we have to consider everyone’s varied desires which they may have as they use the feature, we have to fix bugs. If there’s design problems, we may not find out for a long time but then once we do we then have to figure out how to fix them without breaking people, or we have to migrate all our existing widgets to the new architecture, etc.</p><p>Basically, code is expensive. So before we take it, if possible, we like to see if we can prove the code’s value. By creating a package, we can see if people use the feature, how they like it, whether it would be useful for the framework, etc, without having to take on the costs.</p><p>We have two main kinds of packages that are maintained by the Flutter team, both of which live in <a href="https://github.com/flutter/packages">flutter/packages</a>:</p><ol><li>Regular packages, which are pure Dart. Packages can also be written and maintained by people outside the Flutter team.</li><li>Plugin packages, which provide access to platform features and therefore include native code (such as Java or Objective-C) as well as Dart.</li></ol><p>You can also consider making an independent package. Packages are published to <a href="https://pub.dartlang.org/">pub</a>.</p><p>Often once we have made a package we find that that is actually sufficient to solve the problem that the code sets out to solve, and there ends up being no need to bring it into the framework at all.</p></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><a href="/" class="sidebar-title sidebar-title-anchor">Home</a><div class="mobile-nav-links"><div class="navbar-item"><a id="github-mobile" href="https://github.com/SecretStencil" target="">Github</a></div><div class="navbar-item"><a id="notion-mobile" href="https://www.notion.so" target="">Notion</a></div></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-tutorials"><div>Tutorials</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="tutorial-API_Guidelines.html">API_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-API_Security_Guidelines.html">API_Security_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-Dart_Guidelines.html">Dart_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-JS_Guidelines.html">JS_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-MongoDB_Guidelines.html">MongoDB_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-Project_Guidelines.html">Project_Guidelines</a></div><div class="sidebar-section-children"><a href="tutorial-Semantic_Versioning_Guidelines.html">Semantic_Versioning_Guidelines</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>